/**
 * @fileoverview added by tsickle
 * Generated from: lib/dynamic-mat-table/dynamic-mat-table.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
var TableService = /** @class */ (function () {
    function TableService() {
    }
    /************************************* Local Export *****************************************/
    /**
     * ********************************** Local Export ****************************************
     * @return {?}
     */
    TableService.getFormattedTime = /**
     * ********************************** Local Export ****************************************
     * @return {?}
     */
    function () {
        /** @type {?} */
        var today = new Date();
        /** @type {?} */
        var y = today.getFullYear();
        /** @type {?} */
        var m = today.getMonth() + 1;
        /** @type {?} */
        var d = today.getDate();
        /** @type {?} */
        var h = today.getHours();
        /** @type {?} */
        var mi = today.getMinutes();
        /** @type {?} */
        var s = today.getSeconds();
        return y + "-" + m + "-" + d + "-" + h + "-" + mi + "-" + s;
    };
    // private downloadBlob(blob: any, filename: string) {
    //   if (navigator.msSaveBlob) { // IE 10+
    //     navigator.msSaveBlob(blob, filename);
    //   } else {
    //     const link = document.createElement('a');
    //     if (link.download !== undefined) {
    //       // Browsers that support HTML5 download attribute
    //       const link = window.document.createElement('a');
    //       const date = new Date();
    //       link.className = 'download' + date.getUTCFullYear() + date.getUTCMonth() + date.getUTCSeconds();
    //       link.setAttribute('href', blob);
    //       link.setAttribute('download', filename);
    //       link.style.visibility = 'hidden';
    //       link.click();
    //       // setTimeout(() => {
    //       //   const g = document.body.getElementsByClassName(link.className);
    //       //   document.body.removeChild(link);
    //       // });
    //     }
    //   }
    // }
    // private downloadBlob(blob: any, filename: string) {
    //   if (navigator.msSaveBlob) { // IE 10+
    //     navigator.msSaveBlob(blob, filename);
    //   } else {
    //     const link = document.createElement('a');
    //     if (link.download !== undefined) {
    //       // Browsers that support HTML5 download attribute
    //       const link = window.document.createElement('a');
    //       const date = new Date();
    //       link.className = 'download' + date.getUTCFullYear() + date.getUTCMonth() + date.getUTCSeconds();
    //       link.setAttribute('href', blob);
    //       link.setAttribute('download', filename);
    //       link.style.visibility = 'hidden';
    //       link.click();
    //       // setTimeout(() => {
    //       //   const g = document.body.getElementsByClassName(link.className);
    //       //   document.body.removeChild(link);
    //       // });
    //     }
    //   }
    // }
    /**
     * @private
     * @param {?} blob
     * @param {?} filename
     * @return {?}
     */
    TableService.prototype.downloadBlob = 
    // private downloadBlob(blob: any, filename: string) {
    //   if (navigator.msSaveBlob) { // IE 10+
    //     navigator.msSaveBlob(blob, filename);
    //   } else {
    //     const link = document.createElement('a');
    //     if (link.download !== undefined) {
    //       // Browsers that support HTML5 download attribute
    //       const link = window.document.createElement('a');
    //       const date = new Date();
    //       link.className = 'download' + date.getUTCFullYear() + date.getUTCMonth() + date.getUTCSeconds();
    //       link.setAttribute('href', blob);
    //       link.setAttribute('download', filename);
    //       link.style.visibility = 'hidden';
    //       link.click();
    //       // setTimeout(() => {
    //       //   const g = document.body.getElementsByClassName(link.className);
    //       //   document.body.removeChild(link);
    //       // });
    //     }
    //   }
    // }
    /**
     * @private
     * @param {?} blob
     * @param {?} filename
     * @return {?}
     */
    function (blob, filename) {
        if (navigator.msSaveBlob) {
            // IE 10+
            navigator.msSaveBlob(blob, filename);
        }
        else {
            /** @type {?} */
            var link = document.createElement("a");
            if (link.download !== undefined) {
                // Browsers that support HTML5 download attribute
                /** @type {?} */
                var url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", filename);
                link.style.visibility = "hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    };
    /**
     * @template T
     * @param {?} columns
     * @param {?} rows
     * @param {?} selectionModel
     * @param {?=} filename
     * @return {?}
     */
    TableService.prototype.exportToCsv = /**
     * @template T
     * @param {?} columns
     * @param {?} rows
     * @param {?} selectionModel
     * @param {?=} filename
     * @return {?}
     */
    function (columns, rows, selectionModel, filename) {
        if (filename === void 0) { filename = ""; }
        filename = filename === "" ? this.tableName + TableService.getFormattedTime() + ".csv" : filename;
        if (!rows || !rows.length) {
            return;
        }
        /** @type {?} */
        var fields = columns.filter((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return c.exportable !== false && c.display !== 'hiden'; }));
        /** @type {?} */
        var separator = ",";
        /** @type {?} */
        var CR_LF = "\n";
        //'\u0D0A';
        /** @type {?} */
        var keys = fields.map((/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return f.name; }));
        /** @type {?} */
        var headers = fields.map((/**
         * @param {?} f
         * @return {?}
         */
        function (f) { return f.header; }));
        /** @type {?} */
        var csvContent = headers.join(separator) + CR_LF +
            rows
                .map((/**
             * @param {?} row
             * @return {?}
             */
            function (row) {
                return fields.map((/**
                 * @param {?} f
                 * @return {?}
                 */
                function (f) {
                    /** @type {?} */
                    var cell = f.toExport(row, "csv") || "";
                    cell = cell instanceof Date ? cell.toLocaleString() : cell.toString().replace(/"/g, '""');
                    if (cell.search(/("|,|\n)/g) >= 0) {
                        cell = "\"" + cell + "\"";
                    }
                    return cell;
                })).join(separator);
            })).join(CR_LF);
        /** @type {?} */
        var blob = new Blob([
            new Uint8Array([0xEF, 0xBB, 0xBF]),
            csvContent
        ], { type: 'text/csv;charset=utf-8' });
        this.downloadBlob(blob, filename);
    };
    /**
     * @param {?} rows
     * @param {?=} filename
     * @return {?}
     */
    TableService.prototype.exportToJson = /**
     * @param {?} rows
     * @param {?=} filename
     * @return {?}
     */
    function (rows, filename) {
        if (filename === void 0) { filename = ""; }
        filename =
            filename === ""
                ? this.tableName + TableService.getFormattedTime() + ".json"
                : filename;
        /** @type {?} */
        var blob = new Blob([JSON.stringify(rows)], {
            type: "text/csv;charset=utf-8;",
        });
        this.downloadBlob(blob, filename);
    };
    /************************************* Save Setting into storage *****************************************/
    /**
     * ********************************** Save Setting into storage ****************************************
     * @param {?} columnInfo
     * @param {?=} saveName
     * @return {?}
     */
    TableService.prototype.loadSavedColumnInfo = /**
     * ********************************** Save Setting into storage ****************************************
     * @param {?} columnInfo
     * @param {?=} saveName
     * @return {?}
     */
    function (columnInfo, saveName) {
        // Only load if a save name is passed in
        if (saveName) {
            if (!localStorage) {
                return;
            }
            /** @type {?} */
            var loadedInfo = localStorage.getItem(saveName + "-columns");
            if (loadedInfo) {
                return JSON.parse(loadedInfo);
            }
            this.saveColumnInfo(columnInfo);
            return columnInfo;
        }
    };
    /**
     * @param {?} columnInfo
     * @param {?=} saveName
     * @return {?}
     */
    TableService.prototype.saveColumnInfo = /**
     * @param {?} columnInfo
     * @param {?=} saveName
     * @return {?}
     */
    function (columnInfo, saveName) {
        if (saveName === void 0) { saveName = this.tableName; }
        // console.log(saveName);
        if (saveName) {
            if (!localStorage) {
                return;
            }
            localStorage.setItem(saveName + "-columns", JSON.stringify(columnInfo));
        }
    };
    TableService.decorators = [
        { type: Injectable, args: [{
                    providedIn: "root",
                },] }
    ];
    /** @nocollapse */
    TableService.ctorParameters = function () { return []; };
    /** @nocollapse */ TableService.ɵprov = i0.ɵɵdefineInjectable({ factory: function TableService_Factory() { return new TableService(); }, token: TableService, providedIn: "root" });
    return TableService;
}());
export { TableService };
if (false) {
    /** @type {?} */
    TableService.prototype.tableName;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1tYXQtdGFibGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2R5bmFtaWMtbWF0LXRhYmxlLyIsInNvdXJjZXMiOlsibGliL2R5bmFtaWMtbWF0LXRhYmxlL2R5bmFtaWMtbWF0LXRhYmxlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQUczQztJQU1FO0lBQWUsQ0FBQztJQUVoQiw4RkFBOEY7Ozs7O0lBQ3ZGLDZCQUFnQjs7OztJQUF2Qjs7WUFDUSxLQUFLLEdBQUcsSUFBSSxJQUFJLEVBQUU7O1lBQ2xCLENBQUMsR0FBRyxLQUFLLENBQUMsV0FBVyxFQUFFOztZQUN2QixDQUFDLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUM7O1lBQ3hCLENBQUMsR0FBRyxLQUFLLENBQUMsT0FBTyxFQUFFOztZQUNuQixDQUFDLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRTs7WUFDcEIsRUFBRSxHQUFHLEtBQUssQ0FBQyxVQUFVLEVBQUU7O1lBQ3ZCLENBQUMsR0FBRyxLQUFLLENBQUMsVUFBVSxFQUFFO1FBQzVCLE9BQU8sQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxFQUFFLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQsc0RBQXNEO0lBQ3RELDBDQUEwQztJQUMxQyw0Q0FBNEM7SUFDNUMsYUFBYTtJQUNiLGdEQUFnRDtJQUNoRCx5Q0FBeUM7SUFDekMsMERBQTBEO0lBQzFELHlEQUF5RDtJQUN6RCxpQ0FBaUM7SUFDakMseUdBQXlHO0lBQ3pHLHlDQUF5QztJQUN6QyxpREFBaUQ7SUFDakQsMENBQTBDO0lBQzFDLHNCQUFzQjtJQUN0Qiw4QkFBOEI7SUFDOUIsNkVBQTZFO0lBQzdFLDhDQUE4QztJQUM5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LFVBQVUsQ0FBQyxDQUFDO2FBQy9CO1lBQ0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNoQyxPQUFPLFVBQVUsQ0FBQztTQUNuQjtJQUNILENBQUM7Ozs7OztJQUVNLHFDQUFjOzs7OztJQUFyQixVQUNFLFVBQTZCLEVBQzdCLFFBQWlDO1FBQWpDLHlCQUFBLEVBQUEsV0FBbUIsSUFBSSxDQUFDLFNBQVM7UUFFakMseUJBQXlCO1FBQ3pCLElBQUksUUFBUSxFQUFFO1lBQ1osSUFBSSxDQUFDLFlBQVksRUFBRTtnQkFDakIsT0FBTzthQUNSO1lBRUQsWUFBWSxDQUFDLE9BQU8sQ0FBSSxRQUFRLGFBQVUsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7U0FDekU7SUFDSCxDQUFDOztnQkF0SUYsVUFBVSxTQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7Ozs7dUJBTEQ7Q0EwSUMsQUF2SUQsSUF1SUM7U0FwSVksWUFBWTs7O0lBQ3ZCLGlDQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGFibGVGaWVsZCB9IGZyb20gJy4uL21vZGVscy90YWJsZS1maWVsZC5tb2RlbCc7XHJcbmltcG9ydCB7IFNlbGVjdGlvbk1vZGVsIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvbGxlY3Rpb25zJztcclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46IFwicm9vdFwiLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGFibGVTZXJ2aWNlIHtcclxuICBwdWJsaWMgdGFibGVOYW1lOiBzdHJpbmc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge31cclxuXHJcbiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogTG9jYWwgRXhwb3J0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG4gIHN0YXRpYyBnZXRGb3JtYXR0ZWRUaW1lKCkge1xyXG4gICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xyXG4gICAgY29uc3QgeSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7XHJcbiAgICBjb25zdCBtID0gdG9kYXkuZ2V0TW9udGgoKSArIDE7XHJcbiAgICBjb25zdCBkID0gdG9kYXkuZ2V0RGF0ZSgpO1xyXG4gICAgY29uc3QgaCA9IHRvZGF5LmdldEhvdXJzKCk7XHJcbiAgICBjb25zdCBtaSA9IHRvZGF5LmdldE1pbnV0ZXMoKTtcclxuICAgIGNvbnN0IHMgPSB0b2RheS5nZXRTZWNvbmRzKCk7XHJcbiAgICByZXR1cm4geSArIFwiLVwiICsgbSArIFwiLVwiICsgZCArIFwiLVwiICsgaCArIFwiLVwiICsgbWkgKyBcIi1cIiArIHM7XHJcbiAgfVxyXG5cclxuICAvLyBwcml2YXRlIGRvd25sb2FkQmxvYihibG9iOiBhbnksIGZpbGVuYW1lOiBzdHJpbmcpIHtcclxuICAvLyAgIGlmIChuYXZpZ2F0b3IubXNTYXZlQmxvYikgeyAvLyBJRSAxMCtcclxuICAvLyAgICAgbmF2aWdhdG9yLm1zU2F2ZUJsb2IoYmxvYiwgZmlsZW5hbWUpO1xyXG4gIC8vICAgfSBlbHNlIHtcclxuICAvLyAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAvLyAgICAgaWYgKGxpbmsuZG93bmxvYWQgIT09IHVuZGVmaW5lZCkge1xyXG4gIC8vICAgICAgIC8vIEJyb3dzZXJzIHRoYXQgc3VwcG9ydCBIVE1MNSBkb3dubG9hZCBhdHRyaWJ1dGVcclxuICAvLyAgICAgICBjb25zdCBsaW5rID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAvLyAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcclxuICAvLyAgICAgICBsaW5rLmNsYXNzTmFtZSA9ICdkb3dubG9hZCcgKyBkYXRlLmdldFVUQ0Z1bGxZZWFyKCkgKyBkYXRlLmdldFVUQ01vbnRoKCkgKyBkYXRlLmdldFVUQ1NlY29uZHMoKTtcclxuICAvLyAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIGJsb2IpO1xyXG4gIC8vICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIGZpbGVuYW1lKTtcclxuICAvLyAgICAgICBsaW5rLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuICAvLyAgICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgLy8gICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgLy8gICAgICAgLy8gICBjb25zdCBnID0gZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGxpbmsuY2xhc3NOYW1lKTtcclxuICAvLyAgICAgICAvLyAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7XHJcbiAgLy8gICAgICAgLy8gfSk7XHJcbiAgLy8gICAgIH1cclxuICAvLyAgIH1cclxuICAvLyB9XHJcblxyXG4gIHByaXZhdGUgZG93bmxvYWRCbG9iKGJsb2I6IEJsb2IgfCBhbnksIGZpbGVuYW1lOiBzdHJpbmcpIHtcclxuICAgIGlmIChuYXZpZ2F0b3IubXNTYXZlQmxvYikge1xyXG4gICAgICAvLyBJRSAxMCtcclxuICAgICAgbmF2aWdhdG9yLm1zU2F2ZUJsb2IoYmxvYiwgZmlsZW5hbWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG4gICAgICBpZiAobGluay5kb3dubG9hZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgLy8gQnJvd3NlcnMgdGhhdCBzdXBwb3J0IEhUTUw1IGRvd25sb2FkIGF0dHJpYnV0ZVxyXG4gICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcbiAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsIHVybCk7XHJcbiAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBmaWxlbmFtZSk7XHJcbiAgICAgICAgbGluay5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xyXG4gICAgICAgIGxpbmsuY2xpY2soKTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSAgXHJcblxyXG4gIHB1YmxpYyBleHBvcnRUb0NzdjxUPiggY29sdW1uczogVGFibGVGaWVsZDxUPltdLCByb3dzOiBvYmplY3RbXSwgc2VsZWN0aW9uTW9kZWw6IFNlbGVjdGlvbk1vZGVsPGFueT4sIGZpbGVuYW1lOiBzdHJpbmcgPSBcIlwiKSB7XHJcbiAgICBmaWxlbmFtZSA9IGZpbGVuYW1lID09PSBcIlwiID8gdGhpcy50YWJsZU5hbWUgKyBUYWJsZVNlcnZpY2UuZ2V0Rm9ybWF0dGVkVGltZSgpICsgXCIuY3N2XCIgOiBmaWxlbmFtZTtcclxuICAgIGlmICghcm93cyB8fCAhcm93cy5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfSAgICBcclxuICAgIGNvbnN0IGZpZWxkcyA9IGNvbHVtbnMuZmlsdGVyKChjKSA9PiBjLmV4cG9ydGFibGUgIT09IGZhbHNlICYmIGMuZGlzcGxheSAhPT0gJ2hpZGVuJyk7XHJcbiAgICBjb25zdCBzZXBhcmF0b3IgPSBcIixcIjtcclxuICAgIGNvbnN0IENSX0xGID0gXCJcXG5cIjsgLy8nXFx1MEQwQSc7XHJcbiAgICBjb25zdCBrZXlzID0gZmllbGRzLm1hcCggZiA9PiBmLm5hbWUpO1xyXG4gICAgY29uc3QgaGVhZGVycyA9IGZpZWxkcy5tYXAoIGYgPT4gZi5oZWFkZXIpO1xyXG4gICAgY29uc3QgY3N2Q29udGVudCA9IGhlYWRlcnMuam9pbihzZXBhcmF0b3IpICsgQ1JfTEYgK1xyXG4gICAgICByb3dzXHJcbiAgICAgICAgLm1hcCgocm93KSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gZmllbGRzLm1hcCgoZikgPT4geyAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgbGV0IGNlbGwgPSBmLnRvRXhwb3J0KHJvdywgXCJjc3ZcIikgfHwgXCJcIjtcclxuICAgICAgICAgICAgICBjZWxsID0gY2VsbCBpbnN0YW5jZW9mIERhdGUgPyBjZWxsLnRvTG9jYWxlU3RyaW5nKCkgOiBjZWxsLnRvU3RyaW5nKCkucmVwbGFjZSgvXCIvZywgJ1wiXCInKTtcclxuICAgICAgICAgICAgICBpZiAoY2VsbC5zZWFyY2goLyhcInwsfFxcbikvZykgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgY2VsbCA9IGBcIiR7Y2VsbH1cImA7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiBjZWxsO1xyXG4gICAgICAgICAgICB9KS5qb2luKHNlcGFyYXRvcik7XHJcbiAgICAgICAgfSkuam9pbihDUl9MRik7XHJcbiAgICBcclxuICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbXHJcbiAgICAgIG5ldyBVaW50OEFycmF5KFsweEVGLCAweEJCLCAweEJGXSksIC8qIFVURi04IEJPTSAqL1xyXG4gICAgICBjc3ZDb250ZW50XSwge3R5cGUgOiAndGV4dC9jc3Y7Y2hhcnNldD11dGYtOCd9KTsgICAgXHJcbiAgICB0aGlzLmRvd25sb2FkQmxvYihibG9iLCBmaWxlbmFtZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZXhwb3J0VG9Kc29uKHJvd3M6IG9iamVjdFtdLCBmaWxlbmFtZTogc3RyaW5nID0gXCJcIikge1xyXG4gICAgZmlsZW5hbWUgPVxyXG4gICAgICBmaWxlbmFtZSA9PT0gXCJcIlxyXG4gICAgICAgID8gdGhpcy50YWJsZU5hbWUgKyBUYWJsZVNlcnZpY2UuZ2V0Rm9ybWF0dGVkVGltZSgpICsgXCIuanNvblwiXHJcbiAgICAgICAgOiBmaWxlbmFtZTtcclxuICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbSlNPTi5zdHJpbmdpZnkocm93cyldLCB7XHJcbiAgICAgIHR5cGU6IFwidGV4dC9jc3Y7Y2hhcnNldD11dGYtODtcIixcclxuICAgIH0pO1xyXG4gICAgdGhpcy5kb3dubG9hZEJsb2IoYmxvYiwgZmlsZW5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogU2F2ZSBTZXR0aW5nIGludG8gc3RvcmFnZSAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuICBwdWJsaWMgbG9hZFNhdmVkQ29sdW1uSW5mbyhcclxuICAgIGNvbHVtbkluZm86IFRhYmxlRmllbGQ8YW55PltdLFxyXG4gICAgc2F2ZU5hbWU/OiBzdHJpbmdcclxuICApOiBUYWJsZUZpZWxkPGFueT5bXSB7XHJcbiAgICAvLyBPbmx5IGxvYWQgaWYgYSBzYXZlIG5hbWUgaXMgcGFzc2VkIGluXHJcbiAgICBpZiAoc2F2ZU5hbWUpIHtcclxuICAgICAgaWYgKCFsb2NhbFN0b3JhZ2UpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGxvYWRlZEluZm8gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgJHtzYXZlTmFtZX0tY29sdW1uc2ApO1xyXG5cclxuICAgICAgaWYgKGxvYWRlZEluZm8pIHtcclxuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShsb2FkZWRJbmZvKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnNhdmVDb2x1bW5JbmZvKGNvbHVtbkluZm8pO1xyXG4gICAgICByZXR1cm4gY29sdW1uSW5mbztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzYXZlQ29sdW1uSW5mbyhcclxuICAgIGNvbHVtbkluZm86IFRhYmxlRmllbGQ8YW55PltdLFxyXG4gICAgc2F2ZU5hbWU6IHN0cmluZyA9IHRoaXMudGFibGVOYW1lXHJcbiAgKTogdm9pZCB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhzYXZlTmFtZSk7XHJcbiAgICBpZiAoc2F2ZU5hbWUpIHtcclxuICAgICAgaWYgKCFsb2NhbFN0b3JhZ2UpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGAke3NhdmVOYW1lfS1jb2x1bW5zYCwgSlNPTi5zdHJpbmdpZnkoY29sdW1uSW5mbykpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=