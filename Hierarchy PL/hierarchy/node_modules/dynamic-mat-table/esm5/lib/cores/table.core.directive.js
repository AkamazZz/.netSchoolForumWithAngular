/**
 * @fileoverview added by tsickle
 * Generated from: lib/cores/table.core.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { TableVirtualScrollDataSource } from './table-data-source';
import { ViewChild, Input, Output, EventEmitter, HostBinding, ChangeDetectorRef } from '@angular/core';
import { titleCase } from '../utilies/text.utils';
import { CdkVirtualScrollViewport } from '@angular/cdk/scrolling';
import { moveItemInArray } from '@angular/cdk/drag-drop';
import { SelectionModel } from '@angular/cdk/collections';
import { TableService } from '../dynamic-mat-table/dynamic-mat-table.service';
import { MatSort } from '@angular/material/sort';
import { MatPaginator } from '@angular/material/paginator';
import { MatTable } from '@angular/material/table';
import { Directive } from '@angular/core';
import { clone, getObjectProp, isNullorUndefined } from './type';
import { BehaviorSubject } from 'rxjs';
/**
 * @template T
 */
var TableCoreDirective = /** @class */ (function () {
    function TableCoreDirective(tableService, cdr) {
        this.tableService = tableService;
        this.cdr = cdr;
        this.backgroundColor = null;
        this.contextMenuItems = [];
        this.expandColumn = [];
        this.defaultWidth = null;
        this.minWidth = 120;
        /**
         * ************************************ I/O parameters ********************************
         */
        this.printConfig = {};
        this.rowHeight = 48;
        this.headerHeight = 56;
        this.footerHeight = 48;
        this.headerEnable = true;
        this.footerEnable = false;
        // tslint:disable-next-line: no-output-on-prefix
        this.onTableEvent = new EventEmitter();
        this.onRowEvent = new EventEmitter();
        this.settingChange = new EventEmitter();
        this.paginationChange = new EventEmitter();
        // Variables //
        this.progressColumn = [];
        this.displayedColumns = [];
        this.tvsDataSource = new TableVirtualScrollDataSource([]);
        this._rowSelectionModel = new SelectionModel(true, []);
        this._tablePagination = {};
        this.tablePagingMode = 'none';
        this.viewportClass = 'viewport-with-pagination';
        this.showProgress = true;
        this.tableSetting = {
            direction: 'ltr',
            columnSetting: null,
            visibaleActionMenu: null
        };
    }
    Object.defineProperty(TableCoreDirective.prototype, "direction", {
        get: /**
         * @return {?}
         */
        function () {
            var _a;
            return (_a = this.tableSetting) === null || _a === void 0 ? void 0 : _a.direction;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.tableSetting.direction = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TableCoreDirective.prototype, "ScrollStrategyType", {
        get: /**
         * @return {?}
         */
        function () {
            return this.tableSetting.scrollStrategy;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.viewport['_scrollStrategy'].scrollStrategyMode = value;
            this.tableSetting.scrollStrategy = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TableCoreDirective.prototype, "pagingMode", {
        get: /**
         * @return {?}
         */
        function () {
            return this.tablePagingMode;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.tablePagingMode = value;
            this.updatePagination();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TableCoreDirective.prototype, "pagination", {
        get: /**
         * @return {?}
         */
        function () {
            return this._tablePagination;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value && value !== null) {
                this._tablePagination = value;
                if (isNullorUndefined(this._tablePagination.pageSizeOptions)) {
                    this._tablePagination.pageSizeOptions = [5, 10, 25, 100];
                }
                if (isNullorUndefined(this._tablePagination.pageSizeOptions)) {
                    this._tablePagination.pageSize = this._tablePagination.pageSizeOptions[0];
                }
                this.updatePagination();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TableCoreDirective.prototype, "rowSelectionModel", {
        get: /**
         * @return {?}
         */
        function () {
            return this._rowSelectionModel;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (!isNullorUndefined(value)) {
                if (this._rowSelectionMode && value && this._rowSelectionMode !== 'none') {
                    this._rowSelectionMode = (value.isMultipleSelection() === true ? 'multi' : 'single');
                }
                this._rowSelectionModel = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TableCoreDirective.prototype, "rowSelectionMode", {
        get: /**
         * @return {?}
         */
        function () {
            return this._rowSelectionMode;
        },
        set: /**
         * @param {?} selection
         * @return {?}
         */
        function (selection) {
            selection = selection || 'none';
            this._rowSelectionModel = selection === 'none' ? null : new SelectionModel(selection === 'multi', []);
            if (selection === 'none' && this._rowSelectionMode !== 'none' && this.displayedColumns[0] === 'row-checkbox') {
                this.displayedColumns.shift();
                this.saveSetting(this.tableSetting, false);
            }
            else if (selection !== 'none' && this._rowSelectionMode === 'none') {
                this.displayedColumns.unshift('row-checkbox');
                this.saveSetting(this.tableSetting, false);
            }
            this._rowSelectionMode = selection;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TableCoreDirective.prototype, "tableName", {
        get: /**
         * @return {?}
         */
        function () {
            return this.tableService.tableName;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.tableService.tableName = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TableCoreDirective.prototype, "showProgress", {
        get: /**
         * @return {?}
         */
        function () {
            return this.progressColumn.length > 0;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.progressColumn = [];
            if (value === true) {
                this.progressColumn.push('progress');
            }
        },
        enumerable: true,
        configurable: true
    });
    // private totalRecord = 0;
    // @Input() 
    // get dataSource() {    
    //   if(isNullorUndefined(this.tvsDataSource)) {      
    //     return null;
    //   }    
    //   if (this.totalRecord !== this.tvsDataSource.allData.length) {      
    //     this.initSystemField(this.tvsDataSource.allData);
    //   }
    //   return this.tvsDataSource;
    // } 
    // set dataSource(value: TableVirtualScrollDataSource<T>) {           
    //   this.clear();    
    //   if (!isNullorUndefined(value)) {      
    //     this.initSystemField(value.data);
    //     this.tvsDataSource = value;
    //     this.tvsDataSource.sort = this.sort;
    //     (this.tvsDataSource as any)._paginator = value;      
    //   } 
    // }
    // private totalRecord = 0;
    // @Input() 
    // get dataSource() {    
    //   if(isNullorUndefined(this.tvsDataSource)) {      
    //     return null;
    //   }    
    //   if (this.totalRecord !== this.tvsDataSource.allData.length) {      
    //     this.initSystemField(this.tvsDataSource.allData);
    //   }
    //   return this.tvsDataSource;
    // } 
    // set dataSource(value: TableVirtualScrollDataSource<T>) {           
    //   this.clear();    
    //   if (!isNullorUndefined(value)) {      
    //     this.initSystemField(value.data);
    //     this.tvsDataSource = value;
    //     this.tvsDataSource.sort = this.sort;
    //     (this.tvsDataSource as any)._paginator = value;      
    //   } 
    // }
    /**
     * @protected
     * @param {?} data
     * @return {?}
     */
    TableCoreDirective.prototype.initSystemField = 
    // private totalRecord = 0;
    // @Input() 
    // get dataSource() {    
    //   if(isNullorUndefined(this.tvsDataSource)) {      
    //     return null;
    //   }    
    //   if (this.totalRecord !== this.tvsDataSource.allData.length) {      
    //     this.initSystemField(this.tvsDataSource.allData);
    //   }
    //   return this.tvsDataSource;
    // } 
    // set dataSource(value: TableVirtualScrollDataSource<T>) {           
    //   this.clear();    
    //   if (!isNullorUndefined(value)) {      
    //     this.initSystemField(value.data);
    //     this.tvsDataSource = value;
    //     this.tvsDataSource.sort = this.sort;
    //     (this.tvsDataSource as any)._paginator = value;      
    //   } 
    // }
    /**
     * @protected
     * @param {?} data
     * @return {?}
     */
    function (data) {
        data = data.map((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        function (item, index) {
            item.id = index;
            item.option = item.option || {};
            return item;
        }));
    };
    Object.defineProperty(TableCoreDirective.prototype, "expandComponent", {
        get: /**
         * @return {?}
         */
        function () {
            return this._expandComponent;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._expandComponent = value;
            if (this._expandComponent !== null && this._expandComponent !== undefined) {
                this.expandColumn = ['expandedDetail'];
            }
            else {
                this.expandColumn = [];
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TableCoreDirective.prototype, "columns", {
        get: /**
         * @return {?}
         */
        function () {
            return this.tableColumns;
        },
        set: /**
         * @param {?} fields
         * @return {?}
         */
        function (fields) {
            var _this = this;
            (fields || []).forEach((/**
             * @param {?} f
             * @param {?} i
             * @return {?}
             */
            function (f, i) {
                // key name error //
                if (f.name.toLowerCase() === 'id') {
                    throw 'Field name is reserved.["id"]';
                }
                /** @type {?} */
                var settingFields = (_this.tableSetting.columnSetting || []).filter((/**
                 * @param {?} s
                 * @return {?}
                 */
                function (s) { return s.name === f.name; }));
                /** @type {?} */
                var settingField = settingFields.length > 0 ? settingFields[0] : null;
                // default value for fields
                f.printable = f.printable || true;
                f.exportable = f.exportable || true;
                f.toExport = f.toExport || ((/**
                 * @param {?} value
                 * @param {?} type
                 * @return {?}
                 */
                function (value, type) { return typeof value === 'object' ? null : value || ''; }));
                f.toPrint = (/**
                 * @param {?} value
                 * @return {?}
                 */
                function (value) { return typeof value === 'object' ? null : value || ''; });
                f.enableContextMenu = f.enableContextMenu || true;
                f.header = f.header || titleCase(f.name);
                f.display = getObjectProp('display', 'visible', settingField, f);
                f.filter = getObjectProp('filter', 'client-side', settingField, f);
                f.sort = getObjectProp('sort', 'client-side', settingField, f);
                f.sticky = getObjectProp('sticky', 'none', settingField, f);
                f.width = getObjectProp('width', _this.defaultWidth, settingField, f);
            }));
            this.tableColumns = fields;
            this.updateColumn();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    TableCoreDirective.prototype.updateColumn = /**
     * @return {?}
     */
    function () {
        if (isNullorUndefined(this.tableSetting.columnSetting)) {
            this.tableSetting.columnSetting = clone(this.tableColumns);
            this.refreshTableSetting();
        }
        this.setDisplayedColumns();
    };
    /**************************************** Methods **********************************************/
    /**
     * ************************************* Methods *********************************************
     * @return {?}
     */
    TableCoreDirective.prototype.refreshTableSetting = /**
     * ************************************* Methods *********************************************
     * @return {?}
     */
    function () {
        // this.tableSetting = clone(this.tableSetting);
    };
    /**
     * @return {?}
     */
    TableCoreDirective.prototype.updatePagination = /**
     * @return {?}
     */
    function () {
        if (isNullorUndefined(this.tvsDataSource)) {
            return;
        }
        if (this.tablePagingMode === 'client-side' || this.tablePagingMode === 'server-side') {
            this.viewportClass = 'viewport-with-pagination';
            if (!isNullorUndefined(this.tvsDataSource.paginator)) {
                /** @type {?} */
                var dataLen = this.tvsDataSource.paginator.length;
                if (!isNullorUndefined(this._tablePagination.length) && this._tablePagination.length > dataLen) {
                    dataLen = this._tablePagination.length;
                }
                this.tvsDataSource.paginator.length = dataLen;
            }
        }
        else {
            this.viewportClass = 'viewport';
            if (((/** @type {?} */ (this.tvsDataSource)))._paginator !== undefined) {
                delete ((/** @type {?} */ (this.tvsDataSource)))._paginator;
            }
        }
        this.tvsDataSource.refreshFilterPredicate();
    };
    /**
     * @return {?}
     */
    TableCoreDirective.prototype.clear = /**
     * @return {?}
     */
    function () {
        if (!isNullorUndefined(this.tvsDataSource)) {
            if (this.viewport) {
                this.viewport.scrollTo({ top: 0, behavior: 'auto' });
            }
            this.tvsDataSource.clearData();
            this.expandedElement = null;
        }
        if (this._rowSelectionModel) {
            this._rowSelectionModel.clear();
        }
        this.cdr.detectChanges();
    };
    /**
     * @return {?}
     */
    TableCoreDirective.prototype.setDisplayedColumns = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.columns) {
            this.displayedColumns = [];
            this.columns.forEach((/**
             * @param {?} colunm
             * @param {?} index
             * @return {?}
             */
            function (colunm, index) {
                colunm.index = index;
                if (colunm.display === undefined || colunm.display === 'visible' || colunm.display === 'prevent-hidden') {
                    _this.displayedColumns.push(colunm.name);
                }
            }));
            //bugfixed because of double header show
            // if ((this._rowSelectionMode === 'multi' || this._rowSelectionMode === 'single') && this.displayedColumns.indexOf('row-checkbox') === -1) {
            //   this.displayedColumns.unshift('row-checkbox');
            // } 
            setTimeout((/**
             * @return {?}
             */
            function () {
                if ((_this._rowSelectionMode === 'multi' || _this._rowSelectionMode === 'single') && _this.displayedColumns.indexOf('row-checkbox') === -1) {
                    _this.displayedColumns.unshift('row-checkbox');
                }
            }), 0);
            if (this.tableSetting.visibleTableMenu !== false) {
                this.displayedColumns.push('table-menu');
            }
        }
        // this.updatePagination();
    };
    /************************************ Drag & Drop Column *******************************************/
    /**
     * ********************************* Drag & Drop Column ******************************************
     * @return {?}
     */
    TableCoreDirective.prototype.refreshGrid = /**
     * ********************************* Drag & Drop Column ******************************************
     * @return {?}
     */
    function () {
        this.cdr.detectChanges();
        this.table.renderRows();
    };
    /**
     * @param {?} from
     * @param {?} to
     * @return {?}
     */
    TableCoreDirective.prototype.moveRow = /**
     * @param {?} from
     * @param {?} to
     * @return {?}
     */
    function (from, to) {
        if (from >= 0 && from < this.tvsDataSource.data.length && to >= 0 && to < this.tvsDataSource.data.length) {
            this.tvsDataSource.data[from].id = to;
            this.tvsDataSource.data[to].id = from;
            moveItemInArray(this.tvsDataSource.data, from, to);
            this.tvsDataSource.data = Object.assign([], this.tvsDataSource.data);
        }
    };
    /**
     * @param {?} from
     * @param {?} to
     * @return {?}
     */
    TableCoreDirective.prototype.moveColumn = /**
     * @param {?} from
     * @param {?} to
     * @return {?}
     */
    function (from, to) {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            moveItemInArray(_this.columns, from, to);
            _this.refreshColumn(_this.columns);
        }));
    };
    /**
     * @param {?} columns
     * @return {?}
     */
    TableCoreDirective.prototype.refreshColumn = /**
     * @param {?} columns
     * @return {?}
     */
    function (columns) {
        var _this = this;
        if (this.viewport) {
            /** @type {?} */
            var currentOffset_1 = this.viewport.measureScrollOffset();
            this.columns = columns;
            this.setDisplayedColumns();
            setTimeout((/**
             * @return {?}
             */
            function () { return _this.viewport.scrollTo({ top: currentOffset_1, behavior: 'auto' }); }), 0);
        }
    };
    /**
     * @param {?} tableSetting
     * @param {?=} raiseEvent
     * @return {?}
     */
    TableCoreDirective.prototype.saveSetting = /**
     * @param {?} tableSetting
     * @param {?=} raiseEvent
     * @return {?}
     */
    function (tableSetting, raiseEvent) {
        if (raiseEvent === void 0) { raiseEvent = false; }
        if (tableSetting !== null) {
            this.tableSetting = tableSetting;
            this.refreshColumn(tableSetting.columnSetting);
        }
        if (raiseEvent === true) {
            this.settingChange.emit(this.tableSetting);
        }
    };
    /************************************ Selection Table Row *******************************************/
    /** Whether the number of selected elements matches the total number of rows. */
    /************************************ Selection Table Row *******************************************/
    /**
     * Whether the number of selected elements matches the total number of rows.
     * @return {?}
     */
    TableCoreDirective.prototype.isAllSelected = /************************************ Selection Table Row *******************************************/
    /**
     * Whether the number of selected elements matches the total number of rows.
     * @return {?}
     */
    function () {
        /** @type {?} */
        var numSelected = this._rowSelectionModel.selected.length;
        /** @type {?} */
        var numRows = this.tvsDataSource.data.length;
        return numSelected === numRows;
    };
    /** Selects all rows if they are not all selected; otherwise clear selection. */
    /**
     * Selects all rows if they are not all selected; otherwise clear selection.
     * @return {?}
     */
    TableCoreDirective.prototype.masterToggle = /**
     * Selects all rows if they are not all selected; otherwise clear selection.
     * @return {?}
     */
    function () {
        var _this = this;
        this.isAllSelected() ?
            this._rowSelectionModel.clear() :
            this.tvsDataSource.data.forEach((/**
             * @param {?} row
             * @return {?}
             */
            function (row) { return _this._rowSelectionModel.select(row); }));
        this.onRowEvent.emit({ event: 'MasterSelectionChange', sender: this._rowSelectionModel });
    };
    /**
     * @param {?} e
     * @param {?} row
     * @return {?}
     */
    TableCoreDirective.prototype.onRowSelectionChange = /**
     * @param {?} e
     * @param {?} row
     * @return {?}
     */
    function (e, row) {
        if (e) {
            this._rowSelectionModel.toggle(row);
            this.onRowEvent.emit({ event: 'RowSelectionChange', sender: this._rowSelectionModel });
        }
    };
    TableCoreDirective.decorators = [
        { type: Directive, args: [{
                    // tslint:disable-next-line:directive-selector
                    selector: '[core]'
                },] }
    ];
    /** @nocollapse */
    TableCoreDirective.ctorParameters = function () { return [
        { type: TableService },
        { type: ChangeDetectorRef }
    ]; };
    TableCoreDirective.propDecorators = {
        sort: [{ type: ViewChild, args: [MatSort, { static: true },] }],
        paginator: [{ type: ViewChild, args: [MatPaginator, { static: true },] }],
        dataSource: [{ type: Input }],
        backgroundColor: [{ type: Input }],
        direction: [{ type: Input }, { type: HostBinding, args: ['style.direction',] }],
        contextMenuItems: [{ type: Input }],
        ScrollStrategyType: [{ type: Input }],
        pagingMode: [{ type: Input }],
        pagination: [{ type: Input }],
        rowSelectionModel: [{ type: Input }],
        rowSelectionMode: [{ type: Input }],
        tableName: [{ type: Input }],
        showProgress: [{ type: Input }],
        expandComponent: [{ type: Input }],
        rowContextMenuItems: [{ type: Input }],
        defaultWidth: [{ type: Input }],
        minWidth: [{ type: Input }],
        columns: [{ type: Input }],
        printConfig: [{ type: Input }],
        sticky: [{ type: Input }],
        pending: [{ type: Input }],
        rowHeight: [{ type: Input }],
        headerHeight: [{ type: Input }],
        footerHeight: [{ type: Input }],
        headerEnable: [{ type: Input }],
        footerEnable: [{ type: Input }],
        showNoData: [{ type: Input }],
        showReload: [{ type: Input }],
        onTableEvent: [{ type: Output }],
        onRowEvent: [{ type: Output }],
        settingChange: [{ type: Output }],
        paginationChange: [{ type: Output }],
        table: [{ type: ViewChild, args: [MatTable, { static: true },] }],
        viewport: [{ type: ViewChild, args: [CdkVirtualScrollViewport, { static: true },] }]
    };
    return TableCoreDirective;
}());
export { TableCoreDirective };
if (false) {
    /** @type {?} */
    TableCoreDirective.prototype.sort;
    /** @type {?} */
    TableCoreDirective.prototype.paginator;
    /** @type {?} */
    TableCoreDirective.prototype.dataSource;
    /** @type {?} */
    TableCoreDirective.prototype.backgroundColor;
    /** @type {?} */
    TableCoreDirective.prototype.contextMenuItems;
    /** @type {?} */
    TableCoreDirective.prototype.expandColumn;
    /**
     * @type {?}
     * @private
     */
    TableCoreDirective.prototype._expandComponent;
    /** @type {?} */
    TableCoreDirective.prototype.rowContextMenuItems;
    /** @type {?} */
    TableCoreDirective.prototype.defaultWidth;
    /** @type {?} */
    TableCoreDirective.prototype.minWidth;
    /**
     * ************************************ I/O parameters ********************************
     * @type {?}
     */
    TableCoreDirective.prototype.printConfig;
    /** @type {?} */
    TableCoreDirective.prototype.sticky;
    /** @type {?} */
    TableCoreDirective.prototype.pending;
    /** @type {?} */
    TableCoreDirective.prototype.rowHeight;
    /** @type {?} */
    TableCoreDirective.prototype.headerHeight;
    /** @type {?} */
    TableCoreDirective.prototype.footerHeight;
    /** @type {?} */
    TableCoreDirective.prototype.headerEnable;
    /** @type {?} */
    TableCoreDirective.prototype.footerEnable;
    /** @type {?} */
    TableCoreDirective.prototype.showNoData;
    /** @type {?} */
    TableCoreDirective.prototype.showReload;
    /** @type {?} */
    TableCoreDirective.prototype.onTableEvent;
    /** @type {?} */
    TableCoreDirective.prototype.onRowEvent;
    /** @type {?} */
    TableCoreDirective.prototype.settingChange;
    /** @type {?} */
    TableCoreDirective.prototype.paginationChange;
    /**
     * ************************************ Expand Row ********************************
     * @type {?}
     */
    TableCoreDirective.prototype.expandedElement;
    /** @type {?} */
    TableCoreDirective.prototype.progressColumn;
    /** @type {?} */
    TableCoreDirective.prototype.displayedColumns;
    /** @type {?} */
    TableCoreDirective.prototype.tableColumns;
    /** @type {?} */
    TableCoreDirective.prototype.tvsDataSource;
    /**
     * @type {?}
     * @private
     */
    TableCoreDirective.prototype._rowSelectionMode;
    /**
     * @type {?}
     * @private
     */
    TableCoreDirective.prototype._rowSelectionModel;
    /**
     * @type {?}
     * @private
     */
    TableCoreDirective.prototype._tablePagination;
    /** @type {?} */
    TableCoreDirective.prototype.tablePagingMode;
    /** @type {?} */
    TableCoreDirective.prototype.viewportClass;
    /** @type {?} */
    TableCoreDirective.prototype.tableSetting;
    /**
     * ************************************* Refrence Variables **************************************
     * @type {?}
     */
    TableCoreDirective.prototype.table;
    /** @type {?} */
    TableCoreDirective.prototype.viewport;
    /** @type {?} */
    TableCoreDirective.prototype.tableService;
    /** @type {?} */
    TableCoreDirective.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29yZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9keW5hbWljLW1hdC10YWJsZS8iLCJzb3VyY2VzIjpbImxpYi9jb3Jlcy90YWJsZS5jb3JlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLGlCQUFpQixFQUFjLE1BQU0sZUFBZSxDQUFDO0FBRW5ILE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNsRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzFELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUk5RSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDakQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sUUFBUSxDQUFDO0FBR2pFLE9BQU8sRUFBRSxlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7Ozs7QUFFbkQ7SUFvTkUsNEJBQW1CLFlBQTBCLEVBQVMsR0FBc0I7UUFBekQsaUJBQVksR0FBWixZQUFZLENBQWM7UUFBUyxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQTVNbkUsb0JBQWUsR0FBVyxJ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QywwQ0FBcUM7O0lBQ3JDLDJDQUFnRzs7Ozs7SUFFaEcsK0NBQThDOzs7OztJQUM5QyxnREFBNkQ7Ozs7O0lBQzdELDhDQUFnRDs7SUFDaEQsNkNBQXNEOztJQUN0RCwyQ0FBMkY7O0lBQzNGLDBDQUEyQjs7Ozs7SUFHM0IsbUNBQThEOztJQUM5RCxzQ0FBNEY7O0lBekJoRiwwQ0FBaUM7O0lBQUUsaUNBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSVJvd0V2ZW50LCBJUm93QWN0aW9uTWVudUV2ZW50LCBUYWJsZVJvdywgVGFibGVTZWxlY3Rpb25Nb2RlLCBJVGFibGVFdmVudCB9IGZyb20gJy4uL21vZGVscy90YWJsZS1yb3cubW9kZWwnO1xyXG5pbXBvcnQgeyBUYWJsZVZpcnR1YWxTY3JvbGxEYXRhU291cmNlIH0gZnJvbSAnLi90YWJsZS1kYXRhLXNvdXJjZSc7XHJcbmltcG9ydCB7IFZpZXdDaGlsZCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBIb3N0QmluZGluZywgQ2hhbmdlRGV0ZWN0b3JSZWYsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGFibGVGaWVsZCB9IGZyb20gJy4uL21vZGVscy90YWJsZS1maWVsZC5tb2RlbCc7XHJcbmltcG9ydCB7IHRpdGxlQ2FzZSB9IGZyb20gJy4uL3V0aWxpZXMvdGV4dC51dGlscyc7XHJcbmltcG9ydCB7IENka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9zY3JvbGxpbmcnO1xyXG5pbXBvcnQgeyBtb3ZlSXRlbUluQXJyYXkgfSBmcm9tICdAYW5ndWxhci9jZGsvZHJhZy1kcm9wJztcclxuaW1wb3J0IHsgU2VsZWN0aW9uTW9kZWwgfSBmcm9tICdAYW5ndWxhci9jZGsvY29sbGVjdGlvbnMnO1xyXG5pbXBvcnQgeyBUYWJsZVNlcnZpY2UgfSBmcm9tICcuLi9keW5hbWljLW1hdC10YWJsZS9keW5hbWljLW1hdC10YWJsZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVGFibGVQYWdpbmF0aW9uLCBUYWJsZVBhZ2luYXRpb25Nb2RlIH0gZnJvbSAnLi4vbW9kZWxzL3RhYmxlLXBhZ2luYXRpb24ubW9kZWwnO1xyXG5pbXBvcnQgeyBQcmludENvbmZpZyB9IGZyb20gJy4uL21vZGVscy9wcmludC1jb25maWcubW9kZWwnO1xyXG5pbXBvcnQgeyBUYWJsZVNldHRpbmcsIERpcmVjdGlvbiB9IGZyb20gJy4uL21vZGVscy90YWJsZS1zZXR0aW5nLm1vZGVsJztcclxuaW1wb3J0IHsgTWF0U29ydCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NvcnQnO1xyXG5pbXBvcnQgeyBNYXRQYWdpbmF0b3IgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9wYWdpbmF0b3InO1xyXG5pbXBvcnQgeyBNYXRUYWJsZSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3RhYmxlJztcclxuaW1wb3J0IHsgRGlyZWN0aXZlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGNsb25lLCBnZXRPYmplY3RQcm9wLCBpc051bGxvclVuZGVmaW5lZCB9IGZyb20gJy4vdHlwZSc7XHJcbmltcG9ydCB7IFRhYmxlU2Nyb2xsU3RyYXRlZ3kgfSBmcm9tICcuL2ZpeGVkLXNpemUtdGFibGUtdmlydHVhbC1zY3JvbGwtc3RyYXRlZ3knO1xyXG5pbXBvcnQgeyBDb250ZXh0TWVudUl0ZW0gfSBmcm9tICcuLi9tb2RlbHMvY29udGV4dC1tZW51Lm1vZGVsJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6ZGlyZWN0aXZlLXNlbGVjdG9yXHJcbiAgc2VsZWN0b3I6ICdbY29yZV0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUYWJsZUNvcmVEaXJlY3RpdmU8VCBleHRlbmRzIFRhYmxlUm93PiB7XHJcbiAgQFZpZXdDaGlsZChNYXRTb3J0LCB7IHN0YXRpYzogdHJ1ZSB9KSBzb3J0OiBNYXRTb3J0O1xyXG4gIEBWaWV3Q2hpbGQoTWF0UGFnaW5hdG9yLCB7IHN0YXRpYzogdHJ1ZSB9KSBwYWdpbmF0b3I6IE1hdFBhZ2luYXRvcjsgXHJcbiAgQElucHV0KCkgcHVibGljIGRhdGFTb3VyY2U6IEJlaGF2aW9yU3ViamVjdDxhbnlbXT47XHJcbiAgQElucHV0KCkgYmFja2dyb3VuZENvbG9yOiBzdHJpbmcgPSBudWxsO1xyXG4gIEBJbnB1dCgpXHJcbiAgQEhvc3RCaW5kaW5nKCdzdHlsZS5kaXJlY3Rpb24nKVxyXG4gIGdldCBkaXJlY3Rpb24oKTogRGlyZWN0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLnRhYmxlU2V0dGluZz8uZGlyZWN0aW9uO1xyXG4gIH1cclxuICBzZXQgZGlyZWN0aW9uKHZhbHVlOiBEaXJlY3Rpb24pIHtcclxuICAgIHRoaXMudGFibGVTZXR0aW5nLmRpcmVjdGlvbiA9IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KCkgY29udGV4dE1lbnVJdGVtczogQ29udGV4dE1lbnVJdGVtW10gPSBbXTtcclxuICBASW5wdXQoKVxyXG4gIGdldCBTY3JvbGxTdHJhdGVneVR5cGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy50YWJsZVNldHRpbmcuc2Nyb2xsU3RyYXRlZ3k7XHJcbiAgfVxyXG4gIHNldCBTY3JvbGxTdHJhdGVneVR5cGUodmFsdWU6IFRhYmxlU2Nyb2xsU3RyYXRlZ3kpIHsgICAgICAgIFxyXG4gICAgdGhpcy52aWV3cG9ydFsnX3Njcm9sbFN0cmF0ZWd5J10uc2Nyb2xsU3RyYXRlZ3lNb2RlID0gdmFsdWU7XHJcbiAgICB0aGlzLnRhYmxlU2V0dGluZy5zY3JvbGxTdHJhdGVneSA9IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBnZXQgcGFnaW5nTW9kZSgpIHtcclxuICAgIHJldHVybiB0aGlzLnRhYmxlUGFnaW5nTW9kZTtcclxuICB9XHJcbiAgc2V0IHBhZ2luZ01vZGUodmFsdWU6IFRhYmxlUGFnaW5hdGlvbk1vZGUpIHtcclxuICAgIHRoaXMudGFibGVQYWdpbmdNb2RlID0gdmFsdWU7XHJcbiAgICB0aGlzLnVwZGF0ZVBhZ2luYXRpb24oKTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IHBhZ2luYXRpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fdGFibGVQYWdpbmF0aW9uO1xyXG4gIH1cclxuICBzZXQgcGFnaW5hdGlvbih2YWx1ZTogVGFibGVQYWdpbmF0aW9uKSB7XHJcbiAgICBpZiAodmFsdWUgJiYgdmFsdWUgIT09IG51bGwpIHtcclxuICAgICAgdGhpcy5fdGFibGVQYWdpbmF0aW9uID0gdmFsdWU7XHJcbiAgICAgIGlmICggaXNOdWxsb3JVbmRlZmluZWQodGhpcy5fdGFibGVQYWdpbmF0aW9uLnBhZ2VTaXplT3B0aW9ucykpIHtcclxuICAgICAgICB0aGlzLl90YWJsZVBhZ2luYXRpb24ucGFnZVNpemVPcHRpb25zID0gWzUsIDEwLCAyNSwgMTAwXTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoIGlzTnVsbG9yVW5kZWZpbmVkKHRoaXMuX3RhYmxlUGFnaW5hdGlvbi5wYWdlU2l6ZU9wdGlvbnMpKSB7XHJcbiAgICAgICAgdGhpcy5fdGFibGVQYWdpbmF0aW9uLnBhZ2VTaXplID0gdGhpcy5fdGFibGVQYWdpbmF0aW9uLnBhZ2VTaXplT3B0aW9uc1swXTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnVwZGF0ZVBhZ2luYXRpb24oKTtcclxuICAgIH1cclxuICB9IFxyXG5cclxuICBASW5wdXQoKVxyXG4gIGdldCByb3dTZWxlY3Rpb25Nb2RlbCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlbDtcclxuICB9XHJcbiAgc2V0IHJvd1NlbGVjdGlvbk1vZGVsKHZhbHVlOiBTZWxlY3Rpb25Nb2RlbDxUPikgeyBcclxuICAgIGlmICghaXNOdWxsb3JVbmRlZmluZWQodmFsdWUpKSB7XHJcbiAgICAgIGlmICh0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlICYmIHZhbHVlICYmIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgIT09ICdub25lJykge1xyXG4gICAgICAgIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgPSAodmFsdWUuaXNNdWx0aXBsZVNlbGVjdGlvbigpID09PSB0cnVlID8gJ211bHRpJzogJ3NpbmdsZScpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIGdldCByb3dTZWxlY3Rpb25Nb2RlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGU7XHJcbiAgfVxyXG4gIHNldCByb3dTZWxlY3Rpb25Nb2RlKHNlbGVjdGlvbjogVGFibGVTZWxlY3Rpb25Nb2RlKSB7ICAgIFxyXG4gICAgc2VsZWN0aW9uID0gc2VsZWN0aW9uIHx8ICdub25lJztcclxuICAgIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsID0gc2VsZWN0aW9uID09PSAnbm9uZScgPyBudWxsIDogbmV3IFNlbGVjdGlvbk1vZGVsPFQ+KHNlbGVjdGlvbiA9PT0gJ211bHRpJywgW10pOyAgICBcclxuICAgIGlmKHNlbGVjdGlvbiA9PT0gJ25vbmUnICYmIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgIT09ICdub25lJyAmJiB0aGlzLmRpc3BsYXllZENvbHVtbnNbMF0gPT09ICdyb3ctY2hlY2tib3gnKSB7XHJcbiAgICAgIHRoaXMuZGlzcGxheWVkQ29sdW1ucy5zaGlmdCgpOyAgICAgICAgICAgIFxyXG4gICAgICB0aGlzLnNhdmVTZXR0aW5nKHRoaXMudGFibGVTZXR0aW5nLGZhbHNlKTtcclxuICAgIH0gZWxzZSBpZihzZWxlY3Rpb24gIT09ICdub25lJyAmJiB0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlID09PSAnbm9uZScpIHtcclxuICAgICAgdGhpcy5kaXNwbGF5ZWRDb2x1bW5zLnVuc2hpZnQoJ3Jvdy1jaGVja2JveCcpOyAgICAgICAgICAgIFxyXG4gICAgICB0aGlzLnNhdmVTZXR0aW5nKHRoaXMudGFibGVTZXR0aW5nLGZhbHNlKTtcclxuICAgIH1cclxuICAgIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgPSBzZWxlY3Rpb247ICAgIFxyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBnZXQgdGFibGVOYW1lKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudGFibGVTZXJ2aWNlLnRhYmxlTmFtZTtcclxuICB9XHJcbiAgc2V0IHRhYmxlTmFtZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLnRhYmxlU2VydmljZS50YWJsZU5hbWUgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IHNob3dQcm9ncmVzcygpIHtcclxuICAgIHJldHVybiB0aGlzLnByb2dyZXNzQ29sdW1uLmxlbmd0aCA+IDA7XHJcbiAgfVxyXG4gIHNldCBzaG93UHJvZ3Jlc3ModmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMucHJvZ3Jlc3NDb2x1bW4gPSBbXTtcclxuICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICB0aGlzLnByb2dyZXNzQ29sdW1uLnB1c2goJ3Byb2dyZXNzJyk7XHJcbiAgICB9XHJcbiAgfSBcclxuXHJcbiAgLy8gcHJpdmF0ZSB0b3RhbFJlY29yZCA9IDA7XHJcblxyXG4gIC8vIEBJbnB1dCgpIFxyXG4gIC8vIGdldCBkYXRhU291cmNlKCkgeyAgICBcclxuICAvLyAgIGlmKGlzTnVsbG9yVW5kZWZpbmVkKHRoaXMudHZzRGF0YVNvdXJjZSkpIHsgICAgICBcclxuICAvLyAgICAgcmV0dXJuIG51bGw7XHJcbiAgLy8gICB9ICAgIFxyXG4gIC8vICAgaWYgKHRoaXMudG90YWxSZWNvcmQgIT09IHRoaXMudHZzRGF0YVNvdXJjZS5hbGxEYXRhLmxlbmd0aCkgeyAgICAgIFxyXG4gIC8vICAgICB0aGlzLmluaXRTeXN0ZW1GaWVsZCh0aGlzLnR2c0RhdGFTb3VyY2UuYWxsRGF0YSk7XHJcbiAgLy8gICB9XHJcbiAgLy8gICByZXR1cm4gdGhpcy50dnNEYXRhU291cmNlO1xyXG4gIC8vIH0gXHJcbiAgLy8gc2V0IGRhdGFTb3VyY2UodmFsdWU6IFRhYmxlVmlydHVhbFNjcm9sbERhdGFTb3VyY2U8VD4pIHsgICAgICAgICAgIFxyXG4gIC8vICAgdGhpcy5jbGVhcigpOyAgICBcclxuICAvLyAgIGlmICghaXNOdWxsb3JVbmRlZmluZWQodmFsdWUpKSB7ICAgICAgXHJcbiAgLy8gICAgIHRoaXMuaW5pdFN5c3RlbUZpZWxkKHZhbHVlLmRhdGEpO1xyXG4gIC8vICAgICB0aGlzLnR2c0RhdGFTb3VyY2UgPSB2YWx1ZTtcclxuICAvLyAgICAgdGhpcy50dnNEYXRhU291cmNlLnNvcnQgPSB0aGlzLnNvcnQ7XHJcbiAgLy8gICAgICh0aGlzLnR2c0RhdGFTb3VyY2UgYXMgYW55KS5fcGFnaW5hdG9yID0gdmFsdWU7ICAgICAgXHJcbiAgLy8gICB9IFxyXG4gIC8vIH1cclxuXHJcbiAgcHJvdGVjdGVkIGluaXRTeXN0ZW1GaWVsZChkYXRhOiBhbnlbXSkgeyAgICBcclxuICAgIGRhdGEgPSBkYXRhLm1hcCggKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgIGl0ZW0uaWQgPSBpbmRleCA7XHJcbiAgICAgIGl0ZW0ub3B0aW9uID0gaXRlbS5vcHRpb24gfHwge307ICAgICAgXHJcbiAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZXhwYW5kQ29sdW1uID0gW107XHJcbiAgcHJpdmF0ZSBfZXhwYW5kQ29tcG9uZW50OiBhbnk7XHJcbiAgQElucHV0KClcclxuICBnZXQgZXhwYW5kQ29tcG9uZW50KCk6IGFueSB7ICAgIFxyXG4gICAgcmV0dXJuIHRoaXMuX2V4cGFuZENvbXBvbmVudDtcclxuICB9XHJcbiAgc2V0IGV4cGFuZENvbXBvbmVudCh2YWx1ZTogYW55KSB7ICAgIFxyXG4gICAgdGhpcy5fZXhwYW5kQ29tcG9uZW50ID0gdmFsdWU7XHJcbiAgICBpZiAodGhpcy5fZXhwYW5kQ29tcG9uZW50ICE9PSBudWxsICYmIHRoaXMuX2V4cGFuZENvbXBvbmVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHRoaXMuZXhwYW5kQ29sdW1uID0gWydleHBhbmRlZERldGFpbCddO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5leHBhbmRDb2x1bW4gPSBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBJbnB1dCgpIHB1YmxpYyByb3dDb250ZXh0TWVudUl0ZW1zOiBDb250ZXh0TWVudUl0ZW1bXTtcclxuICBASW5wdXQoKSBkZWZhdWx0V2lkdGg6IG51bWJlciA9IG51bGw7XHJcbiAgQElucHV0KCkgbWluV2lkdGggPSAxMjA7XHJcbiAgQElucHV0KClcclxuICBnZXQgY29sdW1ucygpIHtcclxuICAgIHJldHVybiB0aGlzLnRhYmxlQ29sdW1ucztcclxuICB9XHJcbiAgc2V0IGNvbHVtbnMoZmllbGRzOiBUYWJsZUZpZWxkPFQ+W10pIHtcclxuICAgIChmaWVsZHMgfHwgW10pLmZvckVhY2goKGYsIGkpID0+IHtcclxuICAgICAgLy8ga2V5IG5hbWUgZXJyb3IgLy9cclxuICAgICAgaWYgKGYubmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaWQnKSB7XHJcbiAgICAgICAgdGhyb3cgJ0ZpZWxkIG5hbWUgaXMgcmVzZXJ2ZWQuW1wiaWRcIl0nO1xyXG4gICAgICB9ICAgICAgXHJcbiAgICAgIGNvbnN0IHNldHRpbmdGaWVsZHMgPSAodGhpcy50YWJsZVNldHRpbmcuY29sdW1uU2V0dGluZyB8fCBbXSkuZmlsdGVyKHMgPT4gcy5uYW1lID09PSBmLm5hbWUpO1xyXG4gICAgICBjb25zdCBzZXR0aW5nRmllbGQgPSBzZXR0aW5nRmllbGRzLmxlbmd0aCA+IDAgPyBzZXR0aW5nRmllbGRzWzBdIDogbnVsbDtcclxuICAgICAgLy8gZGVmYXVsdCB2YWx1ZSBmb3IgZmllbGRzXHJcbiAgICAgIGYucHJpbnRhYmxlID0gZi5wcmludGFibGUgfHwgdHJ1ZTtcclxuICAgICAgZi5leHBvcnRhYmxlID0gZi5leHBvcnRhYmxlIHx8IHRydWU7XHJcbiAgICAgIGYudG9FeHBvcnQgPSBmLnRvRXhwb3J0IHx8ICgodmFsdWUsIHR5cGUpID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgPyBudWxsIDogdmFsdWUgfHwgJycpO1xyXG4gICAgICBmLnRvUHJpbnQgPSAodmFsdWUpID0+ICB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnID8gbnVsbCA6IHZhbHVlIHx8ICcnO1xyXG4gICAgICBmLmVuYWJsZUNvbnRleHRNZW51ID0gZi5lbmFibGVDb250ZXh0TWVudSB8fCB0cnVlO1xyXG4gICAgICBmLmhlYWRlciA9IGYuaGVhZGVyIHx8IHRpdGxlQ2FzZShmLm5hbWUpO1xyXG4gICAgICBmLmRpc3BsYXkgPSBnZXRPYmplY3RQcm9wKCdkaXNwbGF5JywgJ3Zpc2libGUnICwgc2V0dGluZ0ZpZWxkLCBmICk7XHJcbiAgICAgIGYuZmlsdGVyID0gZ2V0T2JqZWN0UHJvcCgnZmlsdGVyJywgJ2NsaWVudC1zaWRlJyAsIHNldHRpbmdGaWVsZCwgZiApO1xyXG4gICAgICBmLnNvcnQgPSBnZXRPYmplY3RQcm9wKCdzb3J0JywgJ2NsaWVudC1zaWRlJyAsIHNldHRpbmdGaWVsZCwgZiApO1xyXG4gICAgICBmLnN0aWNreSA9IGdldE9iamVjdFByb3AoJ3N0aWNreScsICdub25lJyAsIHNldHRpbmdGaWVsZCwgZiApO1xyXG4gICAgICBmLndpZHRoID0gIGdldE9iamVjdFByb3AoJ3dpZHRoJywgdGhpcy5kZWZhdWx0V2lkdGggLCBzZXR0aW5nRmllbGQsIGYgKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy50YWJsZUNvbHVtbnMgPSBmaWVsZHM7ICAgXHJcbiAgICB0aGlzLnVwZGF0ZUNvbHVtbigpOyAgICAgXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXBkYXRlQ29sdW1uKCkge1xyXG4gICAgaWYgKGlzTnVsbG9yVW5kZWZpbmVkKHRoaXMudGFibGVTZXR0aW5nLmNvbHVtblNldHRpbmcpKSB7XHJcbiAgICAgIHRoaXMudGFibGVTZXR0aW5nLmNvbHVtblNldHRpbmcgPSBjbG9uZSh0aGlzLnRhYmxlQ29sdW1ucyk7XHJcbiAgICAgIHRoaXMucmVmcmVzaFRhYmxlU2V0dGluZygpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZXREaXNwbGF5ZWRDb2x1bW5zKCk7XHJcbiAgfVxyXG5cclxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIEkvTyBwYXJhbWV0ZXJzICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuICBASW5wdXQoKSBwcmludENvbmZpZzogUHJpbnRDb25maWcgPSB7fTsgIFxyXG4gIEBJbnB1dCgpIHN0aWNreTogYm9vbGVhbjtcclxuICBASW5wdXQoKSBwZW5kaW5nOiBib29sZWFuO1xyXG4gIEBJbnB1dCgpIHJvd0hlaWdodCA9IDQ4O1xyXG4gIEBJbnB1dCgpIGhlYWRlckhlaWdodCA9IDU2O1xyXG4gIEBJbnB1dCgpIGZvb3RlckhlaWdodCA9IDQ4O1xyXG4gIEBJbnB1dCgpIGhlYWRlckVuYWJsZSA9IHRydWU7XHJcbiAgQElucHV0KCkgZm9vdGVyRW5hYmxlID0gZmFsc2U7XHJcbiAgQElucHV0KCkgc2hvd05vRGF0YTogYm9vbGVhbjtcclxuICBASW5wdXQoKSBzaG93UmVsb2FkOiBib29sZWFuOyAgXHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1vdXRwdXQtb24tcHJlZml4XHJcbiAgQE91dHB1dCgpIG9uVGFibGVFdmVudDogRXZlbnRFbWl0dGVyPElUYWJsZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgb25Sb3dFdmVudDogRXZlbnRFbWl0dGVyPElSb3dFdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHNldHRpbmdDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBwYWdpbmF0aW9uQ2hhbmdlOiBFdmVudEVtaXR0ZXI8VGFibGVQYWdpbmF0aW9uPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBcclxuXHJcbiAgLy8qKnRoaXMgZXZlbnQgaXMgZGVwZXJhY3QgYW5kIG1vdmUgdG8gb25Sb3dFdmVudCAqL1xyXG4gIC8vIEBPdXRwdXQoKSByb3dBY3Rpb25NZW51Q2hhbmdlOiBFdmVudEVtaXR0ZXI8SVJvd0FjdGlvbk1lbnVFdmVudDxhbnk+PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBcclxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIEV4cGFuZCBSb3cgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG4gIGV4cGFuZGVkRWxlbWVudDogVGFibGVSb3cgfCBudWxsO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgdGFibGVTZXJ2aWNlOiBUYWJsZVNlcnZpY2UsIHB1YmxpYyBjZHI6IENoYW5nZURldGVjdG9yUmVmKSB7ICAgIFxyXG4gICAgdGhpcy5zaG93UHJvZ3Jlc3MgPSB0cnVlO1xyXG4gICAgdGhpcy50YWJsZVNldHRpbmcgPSB7XHJcbiAgICAgIGRpcmVjdGlvbjogJ2x0cicsXHJcbiAgICAgIGNvbHVtblNldHRpbmc6IG51bGwsXHJcbiAgICAgIHZpc2liYWxlQWN0aW9uTWVudTogbnVsbFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIFZhcmlhYmxlcyAvL1xyXG4gIHByb2dyZXNzQ29sdW1uOiBzdHJpbmdbXSA9IFtdO1xyXG4gIGRpc3BsYXllZENvbHVtbnM6IHN0cmluZ1tdID0gW107XHJcbiAgLy8gcHJpdmF0ZSBtZW51czogVGFibGVNZW51W10gPSBbXTtcclxuICBwdWJsaWMgdGFibGVDb2x1bW5zOiBUYWJsZUZpZWxkPFQ+W107XHJcbiAgcHVibGljIHR2c0RhdGFTb3VyY2U6IFRhYmxlVmlydHVhbFNjcm9sbERhdGFTb3VyY2U8VD4gPSBuZXcgVGFibGVWaXJ0dWFsU2Nyb2xsRGF0YVNvdXJjZTxUPihbXSk7XHJcblxyXG4gIHByaXZhdGUgX3Jvd1NlbGVjdGlvbk1vZGU6IFRhYmxlU2VsZWN0aW9uTW9kZTtcclxuICBwcml2YXRlIF9yb3dTZWxlY3Rpb25Nb2RlbCA9IG5ldyBTZWxlY3Rpb25Nb2RlbDxUPih0cnVlLCBbXSk7XHJcbiAgcHJpdmF0ZSBfdGFibGVQYWdpbmF0aW9uOiBUYWJsZVBhZ2luYXRpb24gPSB7IH07XHJcbiAgcHVibGljIHRhYmxlUGFnaW5nTW9kZTogVGFibGVQYWdpbmF0aW9uTW9kZSAgPSAnbm9uZSc7XHJcbiAgcHVibGljIHZpZXdwb3J0Q2xhc3M6ICd2aWV3cG9ydCcgfCAndmlld3BvcnQtd2l0aC1wYWdpbmF0aW9uJyA9ICd2aWV3cG9ydC13aXRoLXBhZ2luYXRpb24nO1xyXG4gIHRhYmxlU2V0dGluZzogVGFibGVTZXR0aW5nO1xyXG5cclxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBSZWZyZW5jZSBWYXJpYWJsZXMgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG4gIEBWaWV3Q2hpbGQoTWF0VGFibGUsIHsgc3RhdGljOiB0cnVlIH0pIHRhYmxlICE6IE1hdFRhYmxlPGFueT47XHJcbiAgQFZpZXdDaGlsZChDZGtWaXJ0dWFsU2Nyb2xsVmlld3BvcnQsIHsgc3RhdGljOiB0cnVlIH0pIHZpZXdwb3J0ICE6IENka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydDsgICAgXHJcbiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogTWV0aG9kcyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuICByZWZyZXNoVGFibGVTZXR0aW5nKCkge1xyXG4gICAgLy8gdGhpcy50YWJsZVNldHRpbmcgPSBjbG9uZSh0aGlzLnRhYmxlU2V0dGluZyk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVQYWdpbmF0aW9uKCkgeyAgICBcclxuICAgIGlmIChpc051bGxvclVuZGVmaW5lZCh0aGlzLnR2c0RhdGFTb3VyY2UpKXtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfSAgICAgIFxyXG4gICAgaWYgKHRoaXMudGFibGVQYWdpbmdNb2RlID09PSAnY2xpZW50LXNpZGUnIHx8IHRoaXMudGFibGVQYWdpbmdNb2RlID09PSAnc2VydmVyLXNpZGUnKSB7XHJcbiAgICAgIHRoaXMudmlld3BvcnRDbGFzcyA9ICd2aWV3cG9ydC13aXRoLXBhZ2luYXRpb24nO1xyXG4gICAgICBpZiAoICFpc051bGxvclVuZGVmaW5lZCh0aGlzLnR2c0RhdGFTb3VyY2UucGFnaW5hdG9yKSkge1xyXG4gICAgICAgIGxldCBkYXRhTGVuID0gdGhpcy50dnNEYXRhU291cmNlLnBhZ2luYXRvci5sZW5ndGg7XHJcbiAgICAgICAgaWYgKCFpc051bGxvclVuZGVmaW5lZCh0aGlzLl90YWJsZVBhZ2luYXRpb24ubGVuZ3RoKSAmJiB0aGlzLl90YWJsZVBhZ2luYXRpb24ubGVuZ3RoID4gZGF0YUxlbikge1xyXG4gICAgICAgICAgZGF0YUxlbiA9IHRoaXMuX3RhYmxlUGFnaW5hdGlvbi5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudHZzRGF0YVNvdXJjZS5wYWdpbmF0b3IubGVuZ3RoID0gZGF0YUxlbjtcclxuICAgICAgfSBcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudmlld3BvcnRDbGFzcyA9ICd2aWV3cG9ydCc7XHJcbiAgICAgIGlmICgodGhpcy50dnNEYXRhU291cmNlIGFzIGFueSkuX3BhZ2luYXRvciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZGVsZXRlICh0aGlzLnR2c0RhdGFTb3VyY2UgYXMgYW55KS5fcGFnaW5hdG9yO1xyXG4gICAgICB9XHJcbiAgICB9IFxyXG4gICAgdGhpcy50dnNEYXRhU291cmNlLnJlZnJlc2hGaWx0ZXJQcmVkaWNhdGUoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjbGVhcigpIHtcclxuICAgIGlmICghaXNOdWxsb3JVbmRlZmluZWQodGhpcy50dnNEYXRhU291cmNlKSkge1xyXG4gICAgICBpZiAodGhpcy52aWV3cG9ydCkge1xyXG4gICAgICAgIHRoaXMudmlld3BvcnQuc2Nyb2xsVG8oeyB0b3A6IDAsIGJlaGF2aW9yOiAnYXV0bycgfSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy50dnNEYXRhU291cmNlLmNsZWFyRGF0YSgpO1xyXG4gICAgICB0aGlzLmV4cGFuZGVkRWxlbWVudCA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBpZih0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlbCkge1xyXG4gICAgICB0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlbC5jbGVhcigpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpXHJcbiAgfSAgXHJcbiBcclxuICBzZXREaXNwbGF5ZWRDb2x1bW5zKCkgeyAgICBcclxuICAgIGlmICh0aGlzLmNvbHVtbnMpIHtcclxuICAgICAgdGhpcy5kaXNwbGF5ZWRDb2x1bW5zID0gW107XHJcbiAgICAgIHRoaXMuY29sdW1ucy5mb3JFYWNoKChjb2x1bm0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgY29sdW5tLmluZGV4ID0gaW5kZXg7XHJcbiAgICAgICAgaWYgKGNvbHVubS5kaXNwbGF5ID09PSB1bmRlZmluZWQgfHwgY29sdW5tLmRpc3BsYXkgPT09ICd2aXNpYmxlJyB8fCBjb2x1bm0uZGlzcGxheSA9PT0gJ3ByZXZlbnQtaGlkZGVuJykge1xyXG4gICAgICAgICAgdGhpcy5kaXNwbGF5ZWRDb2x1bW5zLnB1c2goY29sdW5tLm5hbWUpO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgICB9KTsgXHJcbiAgICAgIC8vYnVnZml4ZWQgYmVjYXVzZSBvZiBkb3VibGUgaGVhZGVyIHNob3dcclxuICAgICAgLy8gaWYgKCh0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlID09PSAnbXVsdGknIHx8IHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgPT09ICdzaW5nbGUnKSAmJiB0aGlzLmRpc3BsYXllZENvbHVtbnMuaW5kZXhPZigncm93LWNoZWNrYm94JykgPT09IC0xKSB7XHJcbiAgICAgIC8vICAgdGhpcy5kaXNwbGF5ZWRDb2x1bW5zLnVuc2hpZnQoJ3Jvdy1jaGVja2JveCcpO1xyXG4gICAgICAvLyB9IFxyXG4gICAgICBzZXRUaW1lb3V0KCAoKSA9PiB7XHJcbiAgICAgICAgaWYgKCh0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlID09PSAnbXVsdGknIHx8IHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgPT09ICdzaW5nbGUnKSAmJiB0aGlzLmRpc3BsYXllZENvbHVtbnMuaW5kZXhPZigncm93LWNoZWNrYm94JykgPT09IC0xKSB7XHJcbiAgICAgICAgICB0aGlzLmRpc3BsYXllZENvbHVtbnMudW5zaGlmdCgncm93LWNoZWNrYm94Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LCAwKTsgXHJcblxyXG4gICAgICBpZiAodGhpcy50YWJsZVNldHRpbmcudmlzaWJsZVRhYmxlTWVudSAhPT0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLmRpc3BsYXllZENvbHVtbnMucHVzaCgndGFibGUtbWVudScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyB0aGlzLnVwZGF0ZVBhZ2luYXRpb24oKTtcclxuICB9XHJcblxyXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogRHJhZyAmIERyb3AgQ29sdW1uICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovIFxyXG4gIHB1YmxpYyByZWZyZXNoR3JpZCgpIHtcclxuICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKVxyXG4gICAgdGhpcy50YWJsZS5yZW5kZXJSb3dzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbW92ZVJvdyhmcm9tOiBudW1iZXIsIHRvOiBudW1iZXIpIHtcclxuICAgIGlmIChmcm9tID49IDAgJiYgZnJvbSA8IHRoaXMudHZzRGF0YVNvdXJjZS5kYXRhLmxlbmd0aCAgJiYgdG8gPj0gMCAmJiB0byA8IHRoaXMudHZzRGF0YVNvdXJjZS5kYXRhLmxlbmd0aCApIHsgICAgICBcclxuICAgICAgdGhpcy50dnNEYXRhU291cmNlLmRhdGFbZnJvbV0uaWQgPSB0bztcclxuICAgICAgdGhpcy50dnNEYXRhU291cmNlLmRhdGFbdG9dLmlkID0gZnJvbTsgICAgICAgIFxyXG4gICAgICBtb3ZlSXRlbUluQXJyYXkodGhpcy50dnNEYXRhU291cmNlLmRhdGEsIGZyb20sIHRvKTtcclxuICAgICAgdGhpcy50dnNEYXRhU291cmNlLmRhdGEgPSBPYmplY3QuYXNzaWduKFtdLCB0aGlzLnR2c0RhdGFTb3VyY2UuZGF0YSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtb3ZlQ29sdW1uKGZyb206IG51bWJlciwgdG86IG51bWJlcikge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIG1vdmVJdGVtSW5BcnJheSh0aGlzLmNvbHVtbnMsIGZyb20sIHRvKTtcclxuICAgICAgdGhpcy5yZWZyZXNoQ29sdW1uKHRoaXMuY29sdW1ucyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlZnJlc2hDb2x1bW4oY29sdW1uczogVGFibGVGaWVsZDxUPltdKSB7XHJcbiAgICBpZiAodGhpcy52aWV3cG9ydCkgeyAgICAgIFxyXG4gICAgICBjb25zdCBjdXJyZW50T2Zmc2V0ID0gdGhpcy52aWV3cG9ydC5tZWFzdXJlU2Nyb2xsT2Zmc2V0KCk7XHJcbiAgICAgIHRoaXMuY29sdW1ucyA9IGNvbHVtbnM7XHJcbiAgICAgIHRoaXMuc2V0RGlzcGxheWVkQ29sdW1ucygpO1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMudmlld3BvcnQuc2Nyb2xsVG8oeyB0b3A6IGN1cnJlbnRPZmZzZXQsIGJlaGF2aW9yOiAnYXV0bycgfSksIDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2F2ZVNldHRpbmcodGFibGVTZXR0aW5nOiBUYWJsZVNldHRpbmcsIHJhaXNlRXZlbnQ6IGJvb2xlYW4gPSBmYWxzZSkgeyAgICBcclxuICAgIGlmICh0YWJsZVNldHRpbmcgIT09IG51bGwpIHtcclxuICAgICAgdGhpcy50YWJsZVNldHRpbmcgPSB0YWJsZVNldHRpbmc7XHJcbiAgICAgIHRoaXMucmVmcmVzaENvbHVtbih0YWJsZVNldHRpbmcuY29sdW1uU2V0dGluZyk7XHJcbiAgICB9XHJcbiAgICBpZiAocmFpc2VFdmVudCA9PT0gdHJ1ZSkge1xyXG4gICAgICB0aGlzLnNldHRpbmdDaGFuZ2UuZW1pdCh0aGlzLnRhYmxlU2V0dGluZyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIFNlbGVjdGlvbiBUYWJsZSBSb3cgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuXHJcbiAgLyoqIFdoZXRoZXIgdGhlIG51bWJlciBvZiBzZWxlY3RlZCBlbGVtZW50cyBtYXRjaGVzIHRoZSB0b3RhbCBudW1iZXIgb2Ygcm93cy4gKi9cclxuICBpc0FsbFNlbGVjdGVkKCkge1xyXG4gICAgY29uc3QgbnVtU2VsZWN0ZWQgPSB0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlbC5zZWxlY3RlZC5sZW5ndGg7XHJcbiAgICBjb25zdCBudW1Sb3dzID0gdGhpcy50dnNEYXRhU291cmNlLmRhdGEubGVuZ3RoO1xyXG4gICAgcmV0dXJuIG51bVNlbGVjdGVkID09PSBudW1Sb3dzO1xyXG4gIH1cclxuXHJcbiAgLyoqIFNlbGVjdHMgYWxsIHJvd3MgaWYgdGhleSBhcmUgbm90IGFsbCBzZWxlY3RlZDsgb3RoZXJ3aXNlIGNsZWFyIHNlbGVjdGlvbi4gKi9cclxuICBtYXN0ZXJUb2dnbGUoKSB7XHJcbiAgICB0aGlzLmlzQWxsU2VsZWN0ZWQoKSA/XHJcbiAgICAgIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsLmNsZWFyKCkgOlxyXG4gICAgICB0aGlzLnR2c0RhdGFTb3VyY2UuZGF0YS5mb3JFYWNoKHJvdyA9PiB0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlbC5zZWxlY3Qocm93KSk7ICAgIFxyXG4gICAgdGhpcy5vblJvd0V2ZW50LmVtaXQoeyBldmVudDogJ01hc3RlclNlbGVjdGlvbkNoYW5nZScsIHNlbmRlcjogIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsfSk7XHJcbiAgfVxyXG5cclxuICBvblJvd1NlbGVjdGlvbkNoYW5nZShlOiBhbnksIHJvdzogVCkge1xyXG4gICAgaWYgKGUpIHsgICAgICBcclxuICAgICAgdGhpcy5fcm93U2VsZWN0aW9uTW9kZWwudG9nZ2xlKHJvdyk7XHJcbiAgICAgIHRoaXMub25Sb3dFdmVudC5lbWl0KHsgZXZlbnQ6ICdSb3dTZWxlY3Rpb25DaGFuZ2UnLCBzZW5kZXI6ICB0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlbH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIFRoZSBsYWJlbCBmb3IgdGhlIGNoZWNrYm94IG9uIHRoZSBwYXNzZWQgcm93ICovXHJcbiAgLy8gY2hlY2tib3hMYWJlbChyb3c/OiBUKTogc3RyaW5nIHtcclxuICAvLyAgIGlmICghcm93KSB7XHJcbiAgLy8gICAgIHJldHVybiBgJHt0aGlzLmlzQWxsU2VsZWN0ZWQoKSA/ICdzZWxlY3QnIDogJ2Rlc2VsZWN0J30gYWxsYDtcclxuICAvLyAgIH1cclxuICAvLyAgIHJldHVybiBgJHt0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlbC5pc1NlbGVjdGVkKHJvdykgPyAnZGVzZWxlY3QnIDogJ3NlbGVjdCd9IHJvdyAke3Jvdy5pZCArIDF9YDtcclxuICAvLyB9IFxyXG5cclxufVxyXG5cclxuIl19