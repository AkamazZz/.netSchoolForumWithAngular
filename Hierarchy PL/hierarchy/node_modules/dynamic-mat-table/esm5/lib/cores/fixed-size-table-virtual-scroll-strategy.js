/**
 * @fileoverview added by tsickle
 * Generated from: lib/cores/fixed-size-table-virtual-scroll-strategy.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { distinctUntilChanged } from 'rxjs/operators';
import { BehaviorSubject, Subject } from 'rxjs';
/**
 * @record
 */
export function TSVStrategyConfigs() { }
if (false) {
    /** @type {?} */
    TSVStrategyConfigs.prototype.rowHeight;
    /** @type {?} */
    TSVStrategyConfigs.prototype.headerHeight;
    /** @type {?} */
    TSVStrategyConfigs.prototype.footerHeight;
    /** @type {?} */
    TSVStrategyConfigs.prototype.bufferMultiplier;
}
var FixedSizeTableVirtualScrollStrategy = /** @class */ (function () {
    function FixedSizeTableVirtualScrollStrategy() {
        this.length = 0;
        this.indexChange = new Subject();
        this.stickyChange = new Subject();
        this.scrollStrategyMode = 'fixed-size';
        this.renderedRangeStream = new BehaviorSubject({ start: 0, end: 0 });
        this.offsetChange = new BehaviorSubject(0);
        this.scrolledIndexChange = this.indexChange.pipe(distinctUntilChanged());
    }
    Object.defineProperty(FixedSizeTableVirtualScrollStrategy.prototype, "dataLength", {
        get: /**
         * @return {?}
         */
        function () {
            return this.length;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.length = value;
            this.onDataLengthChanged();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.eventsSubscription.unsubscribe();
    };
    /**
     * @param {?} viewport
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.attach = /**
     * @param {?} viewport
     * @return {?}
     */
    function (viewport) {
        this.viewport = viewport;
        this.eventsSubscription = this.viewport.renderedRangeStream.subscribe(this.renderedRangeStream);
        this.onDataLengthChanged();
    };
    /**
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.detach = /**
     * @return {?}
     */
    function () {
        this.indexChange.complete();
        this.stickyChange.complete();
        this.renderedRangeStream.complete();
    };
    /**
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.onContentScrolled = /**
     * @return {?}
     */
    function () {
        this.updateContent();
    };
    /**
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.onDataLengthChanged = /**
     * @return {?}
     */
    function () {
        if (this.viewport) {
            this.viewport.setTotalContentSize(this.dataLength * this.rowHeight + this.headerHeight + this.footerHeight);
        }
        this.updateContent();
    };
    /**
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.onContentRendered = /**
     * @return {?}
     */
    function () {
        // no-op
    };
    /**
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.onRenderedOffsetChanged = /**
     * @return {?}
     */
    function () {
        // no-op
    };
    /**
     * @param {?} index
     * @param {?} behavior
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.scrollToIndex = /**
     * @param {?} index
     * @param {?} behavior
     * @return {?}
     */
    function (index, behavior) {
        // if (this.viewport) {
        //   this.viewport.scrollToOffset( this.rowHeight * index , behavior);
        // }    
        if (!this.viewport || !this.rowHeight) {
            return;
        }
        this.viewport.scrollToOffset((index - 1) * this.rowHeight + this.headerHeight);
    };
    /**
     * @param {?} configs
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.setConfig = /**
     * @param {?} configs
     * @return {?}
     */
    function (configs) {
        var rowHeight = configs.rowHeight, headerHeight = configs.headerHeight, footerHeight = configs.footerHeight, bufferMultiplier = configs.bufferMultiplier;
        if (this.rowHeight === rowHeight
            && this.headerHeight === headerHeight
            && this.footerHeight === footerHeight
            && this.bufferMultiplier === bufferMultiplier) {
            return;
        }
        this.rowHeight = rowHeight;
        this.headerHeight = headerHeight;
        this.footerHeight = footerHeight;
        this.bufferMultiplier = bufferMultiplier;
        this.onDataLengthChanged();
    };
    // bug fixed some time viewport is zero height (i dont know why!)
    // bug fixed some time viewport is zero height (i dont know why!)
    /**
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.getViewportSize = 
    // bug fixed some time viewport is zero height (i dont know why!)
    /**
     * @return {?}
     */
    function () {
        if (this.viewport.getViewportSize() === 0) {
            return this.viewport.elementRef.nativeElement.clientHeight + 52;
        }
        else {
            return this.viewport.getViewportSize();
        }
    };
    /**
     * @private
     * @return {?}
     */
    FixedSizeTableVirtualScrollStrategy.prototype.updateContent = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.viewport || !this.rowHeight) {
            return;
        }
        /** @type {?} */
        var start = 0;
        /** @type {?} */
        var end = this.dataLength;
        if (this.scrollStrategyMode === 'none' && this.viewport.getRenderedRange().start === start && this.viewport.getRenderedRange().end === end) {
            return;
        }
        /** @type {?} */
        var scrollOffset = this.viewport.measureScrollOffset();
        /** @type {?} */
        var amount = Math.ceil(this.getViewportSize() / this.rowHeight);
        /** @type {?} */
        var offset = Math.max(scrollOffset - this.headerHeight, 0);
        /** @type {?} */
        var buffer = Math.ceil(amount * this.bufferMultiplier);
        /** @type {?} */
        var skip = Math.round(offset / this.rowHeight);
        /** @type {?} */
        var index = Math.max(0, skip);
        if (this.scrollStrategyMode === 'fixed-size') {
            start = Math.max(0, index - buffer);
            end = Math.min(this.dataLength, index + amount + buffer);
        }
        /** @type {?} */
        var renderedOffset = start * this.rowHeight;
        this.viewport.setRenderedContentOffset(renderedOffset);
        this.viewport.setRenderedRange({ start: start, end: end });
        this.indexChange.next(index);
        this.stickyChange.next(renderedOffset);
        this.offsetChange.next(offset);
    };
    FixedSizeTableVirtualScrollStrategy.decorators = [
        { type: Injectable }
    ];
    return FixedSizeTableVirtualScrollStrategy;
}());
export { FixedSizeTableVirtualScrollStrategy };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FixedSizeTableVirtualScrollStrategy.prototype.eventsSubscription;
    /**
     * @type {?}
     * @private
     */
    FixedSizeTableVirtualScrollStrategy.prototype.length;
    /**
     * @type {?}
     * @private
     */
    FixedSizeTableVirtualScrollStrategy.prototype.rowHeight;
    /**
     * @type {?}
     * @private
     */
    FixedSizeTableVirtualScrollStrategy.prototype.headerHeight;
    /**
     * @type {?}
     * @private
     */
    FixedSizeTableVirtualScrollStrategy.prototype.footerHeight;
    /**
     * @type {?}
     * @private
     */
    FixedSizeTableVirtualScrollStrategy.prototype.bufferMultiplier;
    /**
     * @type {?}
     * @private
     */
    FixedSizeTableVirtualScrollStrategy.prototype.indexChange;
    /** @type {?} */
    FixedSizeTableVirtualScrollStrategy.prototype.stickyChange;
    /** @type {?} */
    FixedSizeTableVirtualScrollStrategy.prototype.scrollStrategyMode;
    /** @type {?} */
    FixedSizeTableVirtualScrollStrategy.prototype.viewport;
    /** @type {?} */
    FixedSizeTableVirtualScrollStrategy.prototype.renderedRangeStream;
    /** @type {?} */
    FixedSizeTableVirtualScrollStrategy.prototype.offsetChange;
    /** @type {?} */
    FixedSizeTableVirtualScrollStrategy.prototype.scrolledIndexChange;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZml4ZWQtc2l6ZS10YWJsZS12aXJ0dWFsLXNjcm9sbC1zdHJhdGVneS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2R5bmFtaWMtbWF0LXRhYmxlLyIsInNvdXJjZXMiOlsibGliL2NvcmVzL2ZpeGVkLXNpemUtdGFibGUtdmlydHVhbC1zY3JvbGwtc3RyYXRlZ3kudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxlQUFlLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7O0FBS2hELHdDQUtDOzs7SUFKQyx1Q0FBa0I7O0lBQ2xCLDBDQUFxQjs7SUFDckIsMENBQXFCOztJQUNyQiw4Q0FBeUI7O0FBSzNCO0lBQUE7UUFHVSxXQUFNLEdBQUcsQ0FBQyxDQUFDO1FBS1gsZ0JBQVcsR0FBRyxJQUFJLE9BQU8sRUFBVSxDQUFDO1FBQ3JDLGlCQUFZLEdBQUcsSUFBSSxPQUFPLEVBQVUsQ0FBQztRQUNyQyx1QkFBa0IsR0FBd0IsWUFBWSxDQUFDO1FBSXZELHdCQUFtQixHQUFHLElBQUksZUFBZSxDQUFZLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUN6RSxpQkFBWSxHQUFHLElBQUksZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXRDLHdCQUFtQixHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztJQWlIN0UsQ0FBQztJQS9HQyxzQkFBSSwyREFBVTs7OztRQUFkO1lBQ0UsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ3JCLENBQUM7Ozs7O1FBRUQsVUFBZSxLQUFhO1lBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1lBQ3BCLElBQUksQ0FB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LEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQyxDQUFDO1NBQzFEOztZQUNLLGNBQWMsR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVM7UUFFN0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN2RCxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEVBQUMsS0FBSyxPQUFBLEVBQUUsR0FBRyxLQUFBLEVBQUMsQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQ2hDLENBQUM7O2dCQWpJRixVQUFVOztJQWtJWCwwQ0FBQztDQUFBLEFBbElELElBa0lDO1NBaklZLG1DQUFtQzs7Ozs7O0lBQzlDLGlFQUF5Qzs7Ozs7SUFDekMscURBQW1COzs7OztJQUNuQix3REFBMkI7Ozs7O0lBQzNCLDJEQUE4Qjs7Ozs7SUFDOUIsMkRBQThCOzs7OztJQUM5QiwrREFBa0M7Ozs7O0lBQ2xDLDBEQUE0Qzs7SUFDNUMsMkRBQTRDOztJQUM1QyxpRUFBOEQ7O0lBRTlELHVEQUEwQzs7SUFFMUMsa0VBQWdGOztJQUNoRiwyREFBNkM7O0lBRTdDLGtFQUEyRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IENka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydCwgVmlydHVhbFNjcm9sbFN0cmF0ZWd5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3Njcm9sbGluZyc7XHJcbmltcG9ydCB7IExpc3RSYW5nZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2xsZWN0aW9ucyc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBUU1ZTdHJhdGVneUNvbmZpZ3Mge1xyXG4gIHJvd0hlaWdodDogbnVtYmVyO1xyXG4gIGhlYWRlckhlaWdodDogbnVtYmVyO1xyXG4gIGZvb3RlckhlaWdodDogbnVtYmVyO1xyXG4gIGJ1ZmZlck11bHRpcGxpZXI6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGRlY2xhcmUgdHlwZSBUYWJsZVNjcm9sbFN0cmF0ZWd5ID0gJ2ZpeGVkLXNpemUnIHwgJ25vbmUnIHwgbnVsbDtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEZpeGVkU2l6ZVRhYmxlVmlydHVhbFNjcm9sbFN0cmF0ZWd5IGltcGxlbWVudHMgVmlydHVhbFNjcm9sbFN0cmF0ZWd5LCBPbkRlc3Ryb3kgeyAgXHJcbiAgcHJpdmF0ZSBldmVudHNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIGxlbmd0aCA9IDA7XHJcbiAgcHJpdmF0ZSByb3dIZWlnaHQhOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBoZWFkZXJIZWlnaHQhOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBmb290ZXJIZWlnaHQhOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBidWZmZXJNdWx0aXBsaWVyITogbnVtYmVyO1xyXG4gIHByaXZhdGUgaW5kZXhDaGFuZ2UgPSBuZXcgU3ViamVjdDxudW1iZXI+KCk7XHJcbiAgcHVibGljIHN0aWNreUNoYW5nZSA9IG5ldyBTdWJqZWN0PG51bWJlcj4oKTtcclxuICBwdWJsaWMgc2Nyb2xsU3RyYXRlZ3lNb2RlOiBUYWJsZVNjcm9sbFN0cmF0ZWd5ID0gJ2ZpeGVkLXNpemUnO1xyXG5cclxuICBwdWJsaWMgdmlld3BvcnQ6IENka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydDtcclxuXHJcbiAgcHVibGljIHJlbmRlcmVkUmFuZ2VTdHJlYW0gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PExpc3RSYW5nZT4oe3N0YXJ0OiAwLCBlbmQ6IDB9KTtcclxuICBwdWJsaWMgb2Zmc2V0Q2hhbmdlID0gbmV3IEJlaGF2aW9yU3ViamVjdCgwKTtcclxuXHJcbiAgcHVibGljIHNjcm9sbGVkSW5kZXhDaGFuZ2UgPSB0aGlzLmluZGV4Q2hhbmdlLnBpcGUoZGlzdGluY3RVbnRpbENoYW5nZWQoKSk7XHJcblxyXG4gIGdldCBkYXRhTGVuZ3RoKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5sZW5ndGg7XHJcbiAgfVxyXG5cclxuICBzZXQgZGF0YUxlbmd0aCh2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLmxlbmd0aCA9IHZhbHVlO1xyXG4gICAgdGhpcy5vbkRhdGFMZW5ndGhDaGFuZ2VkKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHsgICAgXHJcbiAgICB0aGlzLmV2ZW50c1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGF0dGFjaCh2aWV3cG9ydDogQ2RrVmlydHVhbFNjcm9sbFZpZXdwb3J0KTogdm9pZCB7XHJcbiAgICB0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7XHJcbiAgICB0aGlzLmV2ZW50c1N1YnNjcmlwdGlvbiA9IHRoaXMudmlld3BvcnQucmVuZGVyZWRSYW5nZVN0cmVhbS5zdWJzY3JpYmUodGhpcy5yZW5kZXJlZFJhbmdlU3RyZWFtKTtcclxuICAgIHRoaXMub25EYXRhTGVuZ3RoQ2hhbmdlZCgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGRldGFjaCgpOiB2b2lkIHtcclxuICAgIHRoaXMuaW5kZXhDaGFuZ2UuY29tcGxldGUoKTtcclxuICAgIHRoaXMuc3RpY2t5Q2hhbmdlLmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLnJlbmRlcmVkUmFuZ2VTdHJlYW0uY29tcGxldGUoKTtcclxuICB9XHJcbiBcclxuICBwdWJsaWMgb25Db250ZW50U2Nyb2xsZWQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnVwZGF0ZUNvbnRlbnQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbkRhdGFMZW5ndGhDaGFuZ2VkKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMudmlld3BvcnQpIHtcclxuICAgICAgdGhpcy52aWV3cG9ydC5zZXRUb3RhbENvbnRlbnRTaXplKHRoaXMuZGF0YUxlbmd0aCAqIHRoaXMucm93SGVpZ2h0ICsgdGhpcy5oZWFkZXJIZWlnaHQgKyB0aGlzLmZvb3RlckhlaWdodCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZUNvbnRlbnQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbkNvbnRlbnRSZW5kZXJlZCgpOiB2b2lkIHtcclxuICAgIC8vIG5vLW9wXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25SZW5kZXJlZE9mZnNldENoYW5nZWQoKTogdm9pZCB7XHJcbiAgICAvLyBuby1vcFxyXG4gIH1cclxuXHJcbiAgcHVibGljIHNjcm9sbFRvSW5kZXgoaW5kZXg6IG51bWJlciwgYmVoYXZpb3I6IFNjcm9sbEJlaGF2aW9yKTogdm9pZCB7ICAgIFxyXG4gICAgLy8gaWYgKHRoaXMudmlld3BvcnQpIHtcclxuICAgIC8vICAgdGhpcy52aWV3cG9ydC5zY3JvbGxUb09mZnNldCggdGhpcy5yb3dIZWlnaHQgKiBpbmRleCAsIGJlaGF2aW9yKTtcclxuICAgIC8vIH0gICAgXHJcbiAgICBpZiAoIXRoaXMudmlld3BvcnQgfHwgIXRoaXMucm93SGVpZ2h0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMudmlld3BvcnQuc2Nyb2xsVG9PZmZzZXQoKGluZGV4IC0gMSApICogdGhpcy5yb3dIZWlnaHQgKyB0aGlzLmhlYWRlckhlaWdodCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0Q29uZmlnKGNvbmZpZ3M6IFRTVlN0cmF0ZWd5Q29uZmlncykge1xyXG4gICAgY29uc3Qge3Jvd0hlaWdodCwgaGVhZGVySGVpZ2h0LCBmb290ZXJIZWlnaHQsIGJ1ZmZlck11bHRpcGxpZXJ9ID0gY29uZmlncztcclxuICAgIGlmIChcclxuICAgICAgdGhpcy5yb3dIZWlnaHQgPT09IHJvd0hlaWdodFxyXG4gICAgICAmJiB0aGlzLmhlYWRlckhlaWdodCA9PT0gaGVhZGVySGVpZ2h0XHJcbiAgICAgICYmIHRoaXMuZm9vdGVySGVpZ2h0ID09PSBmb290ZXJIZWlnaHRcclxuICAgICAgJiYgdGhpcy5idWZmZXJNdWx0aXBsaWVyID09PSBidWZmZXJNdWx0aXBsaWVyXHJcbiAgICApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yb3dIZWlnaHQgPSByb3dIZWlnaHQ7XHJcbiAgICB0aGlzLmhlYWRlckhlaWdodCA9IGhlYWRlckhlaWdodDtcclxuICAgIHRoaXMuZm9vdGVySGVpZ2h0ID0gZm9vdGVySGVpZ2h0O1xyXG4gICAgdGhpcy5idWZmZXJNdWx0aXBsaWVyID0gYnVmZmVyTXVsdGlwbGllcjtcclxuICAgIHRoaXMub25EYXRhTGVuZ3RoQ2hhbmdlZCgpO1xyXG4gIH1cclxuXHJcbiAgLy8gYnVnIGZpeGVkIHNvbWUgdGltZSB2aWV3cG9ydCBpcyB6ZXJvIGhlaWdodCAoaSBkb250IGtub3cgd2h5ISlcclxuICBwdWJsaWMgZ2V0Vmlld3BvcnRTaXplKCkge1xyXG4gICAgaWYgKHRoaXMudmlld3BvcnQuZ2V0Vmlld3BvcnRTaXplKCkgPT09IDApIHsgICAgICBcclxuICAgICAgcmV0dXJuIHRoaXMudmlld3BvcnQuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodCArIDUyO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMudmlld3BvcnQuZ2V0Vmlld3BvcnRTaXplKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHVwZGF0ZUNvbnRlbnQoKSB7ICAgIFxyXG4gICAgaWYgKCF0aGlzLnZpZXdwb3J0IHx8ICF0aGlzLnJvd0hlaWdodCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgc3RhcnQgPSAwO1xyXG4gICAgbGV0IGVuZCA9IHRoaXMuZGF0YUxlbmd0aDsgICBcclxuXHJcbiAgICBpZiAoIHRoaXMuc2Nyb2xsU3RyYXRlZ3lNb2RlID09PSAnbm9uZScgJiYgdGhpcy52aWV3cG9ydC5nZXRSZW5kZXJlZFJhbmdlKCkuc3RhcnQgID09PSBzdGFydCAmJiB0aGlzLnZpZXdwb3J0LmdldFJlbmRlcmVkUmFuZ2UoKS5lbmQgID09PSBlbmQgKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH0gXHJcblxyXG4gICAgY29uc3Qgc2Nyb2xsT2Zmc2V0ID0gdGhpcy52aWV3cG9ydC5tZWFzdXJlU2Nyb2xsT2Zmc2V0KCk7XHJcbiAgICBjb25zdCBhbW91bnQgPSBNYXRoLmNlaWwodGhpcy5nZXRWaWV3cG9ydFNpemUoKSAvIHRoaXMucm93SGVpZ2h0KTtcclxuICAgIGNvbnN0IG9mZnNldCA9IE1hdGgubWF4KHNjcm9sbE9mZnNldCAtIHRoaXMuaGVhZGVySGVpZ2h0LCAwKTsgICAgXHJcbiAgICBjb25zdCBidWZmZXIgPSBNYXRoLmNlaWwoYW1vdW50ICogdGhpcy5idWZmZXJNdWx0aXBsaWVyKTtcclxuXHJcbiAgICBjb25zdCBza2lwID0gTWF0aC5yb3VuZChvZmZzZXQgLyB0aGlzLnJvd0hlaWdodCk7XHJcbiAgICBjb25zdCBpbmRleCA9IE1hdGgubWF4KDAsIHNraXApOyAgICBcclxuICAgICBcclxuICAgIGlmICh0aGlzLnNjcm9sbFN0cmF0ZWd5TW9kZSA9PT0gJ2ZpeGVkLXNpemUnKSB7XHJcbiAgICAgIHN0YXJ0ID0gTWF0aC5tYXgoMCwgaW5kZXggLSBidWZmZXIpO1xyXG4gICAgICBlbmQgPSBNYXRoLm1pbih0aGlzLmRhdGFMZW5ndGgsIGluZGV4ICsgYW1vdW50ICsgYnVmZmVyKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlbmRlcmVkT2Zmc2V0ID0gc3RhcnQgKiB0aGlzLnJvd0hlaWdodDsgICAgXHJcbiAgICBcclxuICAgIHRoaXMudmlld3BvcnQuc2V0UmVuZGVyZWRDb250ZW50T2Zmc2V0KHJlbmRlcmVkT2Zmc2V0KTtcclxuICAgIHRoaXMudmlld3BvcnQuc2V0UmVuZGVyZWRSYW5nZSh7c3RhcnQsIGVuZH0pOyAgICBcclxuICAgIHRoaXMuaW5kZXhDaGFuZ2UubmV4dChpbmRleCk7XHJcbiAgICB0aGlzLnN0aWNreUNoYW5nZS5uZXh0KHJlbmRlcmVkT2Zmc2V0KTtcclxuICAgIHRoaXMub2Zmc2V0Q2hhbmdlLm5leHQob2Zmc2V0KVxyXG4gIH1cclxufVxyXG4iXX0=