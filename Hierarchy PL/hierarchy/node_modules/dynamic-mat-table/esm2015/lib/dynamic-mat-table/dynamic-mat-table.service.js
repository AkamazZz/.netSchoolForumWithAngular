/**
 * @fileoverview added by tsickle
 * Generated from: lib/dynamic-mat-table/dynamic-mat-table.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
export class TableService {
    constructor() { }
    /**
     * ********************************** Local Export ****************************************
     * @return {?}
     */
    static getFormattedTime() {
        /** @type {?} */
        const today = new Date();
        /** @type {?} */
        const y = today.getFullYear();
        /** @type {?} */
        const m = today.getMonth() + 1;
        /** @type {?} */
        const d = today.getDate();
        /** @type {?} */
        const h = today.getHours();
        /** @type {?} */
        const mi = today.getMinutes();
        /** @type {?} */
        const s = today.getSeconds();
        return y + "-" + m + "-" + d + "-" + h + "-" + mi + "-" + s;
    }
    // private downloadBlob(blob: any, filename: string) {
    //   if (navigator.msSaveBlob) { // IE 10+
    //     navigator.msSaveBlob(blob, filename);
    //   } else {
    //     const link = document.createElement('a');
    //     if (link.download !== undefined) {
    //       // Browsers that support HTML5 download attribute
    //       const link = window.document.createElement('a');
    //       const date = new Date();
    //       link.className = 'download' + date.getUTCFullYear() + date.getUTCMonth() + date.getUTCSeconds();
    //       link.setAttribute('href', blob);
    //       link.setAttribute('download', filename);
    //       link.style.visibility = 'hidden';
    //       link.click();
    //       // setTimeout(() => {
    //       //   const g = document.body.getElementsByClassName(link.className);
    //       //   document.body.removeChild(link);
    //       // });
    //     }
    //   }
    // }
    /**
     * @private
     * @param {?} blob
     * @param {?} filename
     * @return {?}
     */
    downloadBlob(blob, filename) {
        if (navigator.msSaveBlob) {
            // IE 10+
            navigator.msSaveBlob(blob, filename);
        }
        else {
            /** @type {?} */
            const link = document.createElement("a");
            if (link.download !== undefined) {
                // Browsers that support HTML5 download attribute
                /** @type {?} */
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", filename);
                link.style.visibility = "hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    }
    /**
     * @template T
     * @param {?} columns
     * @param {?} rows
     * @param {?} selectionModel
     * @param {?=} filename
     * @return {?}
     */
    exportToCsv(columns, rows, selectionModel, filename = "") {
        filename = filename === "" ? this.tableName + TableService.getFormattedTime() + ".csv" : filename;
        if (!rows || !rows.length) {
            return;
        }
        /** @type {?} */
        const fields = columns.filter((/**
         * @param {?} c
         * @return {?}
         */
        (c) => c.exportable !== false && c.display !== 'hiden'));
        /** @type {?} */
        const separator = ",";
        /** @type {?} */
        const CR_LF = "\n";
        //'\u0D0A';
        /** @type {?} */
        const keys = fields.map((/**
         * @param {?} f
         * @return {?}
         */
        f => f.name));
        /** @type {?} */
        const headers = fields.map((/**
         * @param {?} f
         * @return {?}
         */
        f => f.header));
        /** @type {?} */
        const csvContent = headers.join(separator) + CR_LF +
            rows
                .map((/**
             * @param {?} row
             * @return {?}
             */
            (row) => {
                return fields.map((/**
                 * @param {?} f
                 * @return {?}
                 */
                (f) => {
                    /** @type {?} */
                    let cell = f.toExport(row, "csv") || "";
                    cell = cell instanceof Date ? cell.toLocaleString() : cell.toString().replace(/"/g, '""');
                    if (cell.search(/("|,|\n)/g) >= 0) {
                        cell = `"${cell}"`;
                    }
                    return cell;
                })).join(separator);
            })).join(CR_LF);
        /** @type {?} */
        const blob = new Blob([
            new Uint8Array([0xEF, 0xBB, 0xBF]),
            csvContent
        ], { type: 'text/csv;charset=utf-8' });
        this.downloadBlob(blob, filename);
    }
    /**
     * @param {?} rows
     * @param {?=} filename
     * @return {?}
     */
    exportToJson(rows, filename = "") {
        filename =
            filename === ""
                ? this.tableName + TableService.getFormattedTime() + ".json"
                : filename;
        /** @type {?} */
        const blob = new Blob([JSON.stringify(rows)], {
            type: "text/csv;charset=utf-8;",
        });
        this.downloadBlob(blob, filename);
    }
    /**
     * ********************************** Save Setting into storage ****************************************
     * @param {?} columnInfo
     * @param {?=} saveName
     * @return {?}
     */
    loadSavedColumnInfo(columnInfo, saveName) {
        // Only load if a save name is passed in
        if (saveName) {
            if (!localStorage) {
                return;
            }
            /** @type {?} */
            const loadedInfo = localStorage.getItem(`${saveName}-columns`);
            if (loadedInfo) {
                return JSON.parse(loadedInfo);
            }
            this.saveColumnInfo(columnInfo);
            return columnInfo;
        }
    }
    /**
     * @param {?} columnInfo
     * @param {?=} saveName
     * @return {?}
     */
    saveColumnInfo(columnInfo, saveName = this.tableName) {
        // console.log(saveName);
        if (saveName) {
            if (!localStorage) {
                return;
            }
            localStorage.setItem(`${saveName}-columns`, JSON.stringify(columnInfo));
        }
    }
}
TableService.decorators = [
    { type: Injectable, args: [{
                providedIn: "root",
            },] }
];
/** @nocollapse */
TableService.ctorParameters = () => [];
/** @nocollapse */ TableService.ɵprov = i0.ɵɵdefineInjectable({ factory: function TableService_Factory() { return new TableService(); }, token: TableService, providedIn: "root" });
if (false) {
    /** @type {?} */
    TableService.prototype.tableName;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1tYXQtdGFibGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2R5bmFtaWMtbWF0LXRhYmxlLyIsInNvdXJjZXMiOlsibGliL2R5bmFtaWMtbWF0LXRhYmxlL2R5bmFtaWMtbWF0LXRhYmxlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQU0zQyxNQUFNLE9BQU8sWUFBWTtJQUd2QixnQkFBZSxDQUFDOzs7OztJQUdoQixNQUFNLENBQUMsZ0JBQWdCOztjQUNmLEtBQUssR0FBRyxJQUFJLElBQUksRUFBRTs7Y0FDbEIsQ0FBQyxHQUFHLEtBQUssQ0FBQyxXQUFXLEVBQUU7O2NBQ3ZCLENBQUMsR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQzs7Y0FDeEIsQ0FBQyxHQUFHLEtBQUssQ0FBQyxPQUFPLEVBQUU7O2NBQ25CLENBQUMsR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFFOztjQUNwQixFQUFFLEdBQUcsS0FBSyxDQUFDLFVBQVUsRUFBRTs7Y0FDdkIsQ0FBQyxHQUFHLEtBQUssQ0FBQyxVQUFVLEVBQUU7UUFDNUIsT0FBTyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLEVBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQzlELENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUF3Qk8sWUFBWSxDQUFDLElBQWdCLEVBQUUsUUFBZ0I7UUFDckQsSUFBSSxTQUFTLENBQUMsVUFBVSxFQUFFO1lBQ3hCLFNBQVM7WUFDVCxTQUFTLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztTQUN0QzthQUFNOztrQkFDQyxJQUFJLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUM7WUFDeEMs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Ozs7Ozs7O0lBRUMsaUNBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUYWJsZUZpZWxkIH0gZnJvbSAnLi4vbW9kZWxzL3RhYmxlLWZpZWxkLm1vZGVsJztcclxuaW1wb3J0IHsgU2VsZWN0aW9uTW9kZWwgfSBmcm9tICdAYW5ndWxhci9jZGsvY29sbGVjdGlvbnMnO1xyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogXCJyb290XCIsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUYWJsZVNlcnZpY2Uge1xyXG4gIHB1YmxpYyB0YWJsZU5hbWU6IHN0cmluZztcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7fVxyXG5cclxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBMb2NhbCBFeHBvcnQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbiAgc3RhdGljIGdldEZvcm1hdHRlZFRpbWUoKSB7XHJcbiAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XHJcbiAgICBjb25zdCB5ID0gdG9kYXkuZ2V0RnVsbFllYXIoKTtcclxuICAgIGNvbnN0IG0gPSB0b2RheS5nZXRNb250aCgpICsgMTtcclxuICAgIGNvbnN0IGQgPSB0b2RheS5nZXREYXRlKCk7XHJcbiAgICBjb25zdCBoID0gdG9kYXkuZ2V0SG91cnMoKTtcclxuICAgIGNvbnN0IG1pID0gdG9kYXkuZ2V0TWludXRlcygpO1xyXG4gICAgY29uc3QgcyA9IHRvZGF5LmdldFNlY29uZHMoKTtcclxuICAgIHJldHVybiB5ICsgXCItXCIgKyBtICsgXCItXCIgKyBkICsgXCItXCIgKyBoICsgXCItXCIgKyBtaSArIFwiLVwiICsgcztcclxuICB9XHJcblxyXG4gIC8vIHByaXZhdGUgZG93bmxvYWRCbG9iKGJsb2I6IGFueSwgZmlsZW5hbWU6IHN0cmluZykge1xyXG4gIC8vICAgaWYgKG5hdmlnYXRvci5tc1NhdmVCbG9iKSB7IC8vIElFIDEwK1xyXG4gIC8vICAgICBuYXZpZ2F0b3IubXNTYXZlQmxvYihibG9iLCBmaWxlbmFtZSk7XHJcbiAgLy8gICB9IGVsc2Uge1xyXG4gIC8vICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gIC8vICAgICBpZiAobGluay5kb3dubG9hZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgLy8gICAgICAgLy8gQnJvd3NlcnMgdGhhdCBzdXBwb3J0IEhUTUw1IGRvd25sb2FkIGF0dHJpYnV0ZVxyXG4gIC8vICAgICAgIGNvbnN0IGxpbmsgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gIC8vICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gIC8vICAgICAgIGxpbmsuY2xhc3NOYW1lID0gJ2Rvd25sb2FkJyArIGRhdGUuZ2V0VVRDRnVsbFllYXIoKSArIGRhdGUuZ2V0VVRDTW9udGgoKSArIGRhdGUuZ2V0VVRDU2Vjb25kcygpO1xyXG4gIC8vICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgYmxvYik7XHJcbiAgLy8gICAgICAgbGluay5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgZmlsZW5hbWUpO1xyXG4gIC8vICAgICAgIGxpbmsuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xyXG4gIC8vICAgICAgIGxpbmsuY2xpY2soKTtcclxuICAvLyAgICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAvLyAgICAgICAvLyAgIGNvbnN0IGcgPSBkb2N1bWVudC5ib2R5LmdldEVsZW1lbnRzQnlDbGFzc05hbWUobGluay5jbGFzc05hbWUpO1xyXG4gIC8vICAgICAgIC8vICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTtcclxuICAvLyAgICAgICAvLyB9KTtcclxuICAvLyAgICAgfVxyXG4gIC8vICAgfVxyXG4gIC8vIH1cclxuXHJcbiAgcHJpdmF0ZSBkb3dubG9hZEJsb2IoYmxvYjogQmxvYiB8IGFueSwgZmlsZW5hbWU6IHN0cmluZykge1xyXG4gICAgaWYgKG5hdmlnYXRvci5tc1NhdmVCbG9iKSB7XHJcbiAgICAgIC8vIElFIDEwK1xyXG4gICAgICBuYXZpZ2F0b3IubXNTYXZlQmxvYihibG9iLCBmaWxlbmFtZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcbiAgICAgIGlmIChsaW5rLmRvd25sb2FkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAvLyBCcm93c2VycyB0aGF0IHN1cHBvcnQgSFRNTDUgZG93bmxvYWQgYXR0cmlidXRlXHJcbiAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgdXJsKTtcclxuICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGZpbGVuYW1lKTtcclxuICAgICAgICBsaW5rLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XHJcbiAgICAgICAgbGluay5jbGljaygpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9ICBcclxuXHJcbiAgcHVibGljIGV4cG9ydFRvQ3N2PFQ+KCBjb2x1bW5zOiBUYWJsZUZpZWxkPFQ+W10sIHJvd3M6IG9iamVjdFtdLCBzZWxlY3Rpb25Nb2RlbDogU2VsZWN0aW9uTW9kZWw8YW55PiwgZmlsZW5hbWU6IHN0cmluZyA9IFwiXCIpIHtcclxuICAgIGZpbGVuYW1lID0gZmlsZW5hbWUgPT09IFwiXCIgPyB0aGlzLnRhYmxlTmFtZSArIFRhYmxlU2VydmljZS5nZXRGb3JtYXR0ZWRUaW1lKCkgKyBcIi5jc3ZcIiA6IGZpbGVuYW1lO1xyXG4gICAgaWYgKCFyb3dzIHx8ICFyb3dzLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9ICAgIFxyXG4gICAgY29uc3QgZmllbGRzID0gY29sdW1ucy5maWx0ZXIoKGMpID0+IGMuZXhwb3J0YWJsZSAhPT0gZmFsc2UgJiYgYy5kaXNwbGF5ICE9PSAnaGlkZW4nKTtcclxuICAgIGNvbnN0IHNlcGFyYXRvciA9IFwiLFwiO1xyXG4gICAgY29uc3QgQ1JfTEYgPSBcIlxcblwiOyAvLydcXHUwRDBBJztcclxuICAgIGNvbnN0IGtleXMgPSBmaWVsZHMubWFwKCBmID0+IGYubmFtZSk7XHJcbiAgICBjb25zdCBoZWFkZXJzID0gZmllbGRzLm1hcCggZiA9PiBmLmhlYWRlcik7XHJcbiAgICBjb25zdCBjc3ZDb250ZW50ID0gaGVhZGVycy5qb2luKHNlcGFyYXRvcikgKyBDUl9MRiArXHJcbiAgICAgIHJvd3NcclxuICAgICAgICAubWFwKChyb3cpID0+IHtcclxuICAgICAgICAgIHJldHVybiBmaWVsZHMubWFwKChmKSA9PiB7ICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBsZXQgY2VsbCA9IGYudG9FeHBvcnQocm93LCBcImNzdlwiKSB8fCBcIlwiO1xyXG4gICAgICAgICAgICAgIGNlbGwgPSBjZWxsIGluc3RhbmNlb2YgRGF0ZSA/IGNlbGwudG9Mb2NhbGVTdHJpbmcoKSA6IGNlbGwudG9TdHJpbmcoKS5yZXBsYWNlKC9cIi9nLCAnXCJcIicpO1xyXG4gICAgICAgICAgICAgIGlmIChjZWxsLnNlYXJjaCgvKFwifCx8XFxuKS9nKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjZWxsID0gYFwiJHtjZWxsfVwiYDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGNlbGw7XHJcbiAgICAgICAgICAgIH0pLmpvaW4oc2VwYXJhdG9yKTtcclxuICAgICAgICB9KS5qb2luKENSX0xGKTtcclxuICAgIFxyXG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtcclxuICAgICAgbmV3IFVpbnQ4QXJyYXkoWzB4RUYsIDB4QkIsIDB4QkZdKSwgLyogVVRGLTggQk9NICovXHJcbiAgICAgIGNzdkNvbnRlbnRdLCB7dHlwZSA6ICd0ZXh0L2NzdjtjaGFyc2V0PXV0Zi04J30pOyAgICBcclxuICAgIHRoaXMuZG93bmxvYWRCbG9iKGJsb2IsIGZpbGVuYW1lKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBleHBvcnRUb0pzb24ocm93czogb2JqZWN0W10sIGZpbGVuYW1lOiBzdHJpbmcgPSBcIlwiKSB7XHJcbiAgICBmaWxlbmFtZSA9XHJcbiAgICAgIGZpbGVuYW1lID09PSBcIlwiXHJcbiAgICAgICAgPyB0aGlzLnRhYmxlTmFtZSArIFRhYmxlU2VydmljZS5nZXRGb3JtYXR0ZWRUaW1lKCkgKyBcIi5qc29uXCJcclxuICAgICAgICA6IGZpbGVuYW1lO1xyXG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtKU09OLnN0cmluZ2lmeShyb3dzKV0sIHtcclxuICAgICAgdHlwZTogXCJ0ZXh0L2NzdjtjaGFyc2V0PXV0Zi04O1wiLFxyXG4gICAgfSk7XHJcbiAgICB0aGlzLmRvd25sb2FkQmxvYihibG9iLCBmaWxlbmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBTYXZlIFNldHRpbmcgaW50byBzdG9yYWdlICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG4gIHB1YmxpYyBsb2FkU2F2ZWRDb2x1bW5JbmZvKFxyXG4gICAgY29sdW1uSW5mbzogVGFibGVGaWVsZDxhbnk+W10sXHJcbiAgICBzYXZlTmFtZT86IHN0cmluZ1xyXG4gICk6IFRhYmxlRmllbGQ8YW55PltdIHtcclxuICAgIC8vIE9ubHkgbG9hZCBpZiBhIHNhdmUgbmFtZSBpcyBwYXNzZWQgaW5cclxuICAgIGlmIChzYXZlTmFtZSkge1xyXG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgbG9hZGVkSW5mbyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGAke3NhdmVOYW1lfS1jb2x1bW5zYCk7XHJcblxyXG4gICAgICBpZiAobG9hZGVkSW5mbykge1xyXG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvYWRlZEluZm8pO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuc2F2ZUNvbHVtbkluZm8oY29sdW1uSW5mbyk7XHJcbiAgICAgIHJldHVybiBjb2x1bW5JbmZvO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHNhdmVDb2x1bW5JbmZvKFxyXG4gICAgY29sdW1uSW5mbzogVGFibGVGaWVsZDxhbnk+W10sXHJcbiAgICBzYXZlTmFtZTogc3RyaW5nID0gdGhpcy50YWJsZU5hbWVcclxuICApOiB2b2lkIHtcclxuICAgIC8vIGNvbnNvbGUubG9nKHNhdmVOYW1lKTtcclxuICAgIGlmIChzYXZlTmFtZSkge1xyXG4gICAgICBpZiAoIWxvY2FsU3RvcmFnZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYCR7c2F2ZU5hbWV9LWNvbHVtbnNgLCBKU09OLnN0cmluZ2lmeShjb2x1bW5JbmZvKSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==