/**
 * @fileoverview added by tsickle
 * Generated from: lib/cores/table.core.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { TableVirtualScrollDataSource } from './table-data-source';
import { ViewChild, Input, Output, EventEmitter, HostBinding, ChangeDetectorRef } from '@angular/core';
import { titleCase } from '../utilies/text.utils';
import { CdkVirtualScrollViewport } from '@angular/cdk/scrolling';
import { moveItemInArray } from '@angular/cdk/drag-drop';
import { SelectionModel } from '@angular/cdk/collections';
import { TableService } from '../dynamic-mat-table/dynamic-mat-table.service';
import { MatSort } from '@angular/material/sort';
import { MatPaginator } from '@angular/material/paginator';
import { MatTable } from '@angular/material/table';
import { Directive } from '@angular/core';
import { clone, getObjectProp, isNullorUndefined } from './type';
import { BehaviorSubject } from 'rxjs';
/**
 * @template T
 */
export class TableCoreDirective {
    /**
     * @param {?} tableService
     * @param {?} cdr
     */
    constructor(tableService, cdr) {
        this.tableService = tableService;
        this.cdr = cdr;
        this.backgroundColor = null;
        this.contextMenuItems = [];
        this.expandColumn = [];
        this.defaultWidth = null;
        this.minWidth = 120;
        /**
         * ************************************ I/O parameters ********************************
         */
        this.printConfig = {};
        this.rowHeight = 48;
        this.headerHeight = 56;
        this.footerHeight = 48;
        this.headerEnable = true;
        this.footerEnable = false;
        // tslint:disable-next-line: no-output-on-prefix
        this.onTableEvent = new EventEmitter();
        this.onRowEvent = new EventEmitter();
        this.settingChange = new EventEmitter();
        this.paginationChange = new EventEmitter();
        // Variables //
        this.progressColumn = [];
        this.displayedColumns = [];
        this.tvsDataSource = new TableVirtualScrollDataSource([]);
        this._rowSelectionModel = new SelectionModel(true, []);
        this._tablePagination = {};
        this.tablePagingMode = 'none';
        this.viewportClass = 'viewport-with-pagination';
        this.showProgress = true;
        this.tableSetting = {
            direction: 'ltr',
            columnSetting: null,
            visibaleActionMenu: null
        };
    }
    /**
     * @return {?}
     */
    get direction() {
        var _a;
        return (_a = this.tableSetting) === null || _a === void 0 ? void 0 : _a.direction;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set direction(value) {
        this.tableSetting.direction = value;
    }
    /**
     * @return {?}
     */
    get ScrollStrategyType() {
        return this.tableSetting.scrollStrategy;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set ScrollStrategyType(value) {
        this.viewport['_scrollStrategy'].scrollStrategyMode = value;
        this.tableSetting.scrollStrategy = value;
    }
    /**
     * @return {?}
     */
    get pagingMode() {
        return this.tablePagingMode;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set pagingMode(value) {
        this.tablePagingMode = value;
        this.updatePagination();
    }
    /**
     * @return {?}
     */
    get pagination() {
        return this._tablePagination;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set pagination(value) {
        if (value && value !== null) {
            this._tablePagination = value;
            if (isNullorUndefined(this._tablePagination.pageSizeOptions)) {
                this._tablePagination.pageSizeOptions = [5, 10, 25, 100];
            }
            if (isNullorUndefined(this._tablePagination.pageSizeOptions)) {
                this._tablePagination.pageSize = this._tablePagination.pageSizeOptions[0];
            }
            this.updatePagination();
        }
    }
    /**
     * @return {?}
     */
    get rowSelectionModel() {
        return this._rowSelectionModel;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set rowSelectionModel(value) {
        if (!isNullorUndefined(value)) {
            if (this._rowSelectionMode && value && this._rowSelectionMode !== 'none') {
                this._rowSelectionMode = (value.isMultipleSelection() === true ? 'multi' : 'single');
            }
            this._rowSelectionModel = value;
        }
    }
    /**
     * @return {?}
     */
    get rowSelectionMode() {
        return this._rowSelectionMode;
    }
    /**
     * @param {?} selection
     * @return {?}
     */
    set rowSelectionMode(selection) {
        selection = selection || 'none';
        this._rowSelectionModel = selection === 'none' ? null : new SelectionModel(selection === 'multi', []);
        if (selection === 'none' && this._rowSelectionMode !== 'none' && this.displayedColumns[0] === 'row-checkbox') {
            this.displayedColumns.shift();
            this.saveSetting(this.tableSetting, false);
        }
        else if (selection !== 'none' && this._rowSelectionMode === 'none') {
            this.displayedColumns.unshift('row-checkbox');
            this.saveSetting(this.tableSetting, false);
        }
        this._rowSelectionMode = selection;
    }
    /**
     * @return {?}
     */
    get tableName() {
        return this.tableService.tableName;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set tableName(value) {
        this.tableService.tableName = value;
    }
    /**
     * @return {?}
     */
    get showProgress() {
        return this.progressColumn.length > 0;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set showProgress(value) {
        this.progressColumn = [];
        if (value === true) {
            this.progressColumn.push('progress');
        }
    }
    // private totalRecord = 0;
    // @Input() 
    // get dataSource() {    
    //   if(isNullorUndefined(this.tvsDataSource)) {      
    //     return null;
    //   }    
    //   if (this.totalRecord !== this.tvsDataSource.allData.length) {      
    //     this.initSystemField(this.tvsDataSource.allData);
    //   }
    //   return this.tvsDataSource;
    // } 
    // set dataSource(value: TableVirtualScrollDataSource<T>) {           
    //   this.clear();    
    //   if (!isNullorUndefined(value)) {      
    //     this.initSystemField(value.data);
    //     this.tvsDataSource = value;
    //     this.tvsDataSource.sort = this.sort;
    //     (this.tvsDataSource as any)._paginator = value;      
    //   } 
    // }
    /**
     * @protected
     * @param {?} data
     * @return {?}
     */
    initSystemField(data) {
        data = data.map((/**
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        (item, index) => {
            item.id = index;
            item.option = item.option || {};
            return item;
        }));
    }
    /**
     * @return {?}
     */
    get expandComponent() {
        return this._expandComponent;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set expandComponent(value) {
        this._expandComponent = value;
        if (this._expandComponent !== null && this._expandComponent !== undefined) {
            this.expandColumn = ['expandedDetail'];
        }
        else {
            this.expandColumn = [];
        }
    }
    /**
     * @return {?}
     */
    get columns() {
        return this.tableColumns;
    }
    /**
     * @param {?} fields
     * @return {?}
     */
    set columns(fields) {
        (fields || []).forEach((/**
         * @param {?} f
         * @param {?} i
         * @return {?}
         */
        (f, i) => {
            // key name error //
            if (f.name.toLowerCase() === 'id') {
                throw 'Field name is reserved.["id"]';
            }
            /** @type {?} */
            const settingFields = (this.tableSetting.columnSetting || []).filter((/**
             * @param {?} s
             * @return {?}
             */
            s => s.name === f.name));
            /** @type {?} */
            const settingField = settingFields.length > 0 ? settingFields[0] : null;
            // default value for fields
            f.printable = f.printable || true;
            f.exportable = f.exportable || true;
            f.toExport = f.toExport || ((/**
             * @param {?} value
             * @param {?} type
             * @return {?}
             */
            (value, type) => typeof value === 'object' ? null : value || ''));
            f.toPrint = (/**
             * @param {?} value
             * @return {?}
             */
            (value) => typeof value === 'object' ? null : value || '');
            f.enableContextMenu = f.enableContextMenu || true;
            f.header = f.header || titleCase(f.name);
            f.display = getObjectProp('display', 'visible', settingField, f);
            f.filter = getObjectProp('filter', 'client-side', settingField, f);
            f.sort = getObjectProp('sort', 'client-side', settingField, f);
            f.sticky = getObjectProp('sticky', 'none', settingField, f);
            f.width = getObjectProp('width', this.defaultWidth, settingField, f);
        }));
        this.tableColumns = fields;
        this.updateColumn();
    }
    /**
     * @return {?}
     */
    updateColumn() {
        if (isNullorUndefined(this.tableSetting.columnSetting)) {
            this.tableSetting.columnSetting = clone(this.tableColumns);
            this.refreshTableSetting();
        }
        this.setDisplayedColumns();
    }
    /**
     * ************************************* Methods *********************************************
     * @return {?}
     */
    refreshTableSetting() {
        // this.tableSetting = clone(this.tableSetting);
    }
    /**
     * @return {?}
     */
    updatePagination() {
        if (isNullorUndefined(this.tvsDataSource)) {
            return;
        }
        if (this.tablePagingMode === 'client-side' || this.tablePagingMode === 'server-side') {
            this.viewportClass = 'viewport-with-pagination';
            if (!isNullorUndefined(this.tvsDataSource.paginator)) {
                /** @type {?} */
                let dataLen = this.tvsDataSource.paginator.length;
                if (!isNullorUndefined(this._tablePagination.length) && this._tablePagination.length > dataLen) {
                    dataLen = this._tablePagination.length;
                }
                this.tvsDataSource.paginator.length = dataLen;
            }
        }
        else {
            this.viewportClass = 'viewport';
            if (((/** @type {?} */ (this.tvsDataSource)))._paginator !== undefined) {
                delete ((/** @type {?} */ (this.tvsDataSource)))._paginator;
            }
        }
        this.tvsDataSource.refreshFilterPredicate();
    }
    /**
     * @return {?}
     */
    clear() {
        if (!isNullorUndefined(this.tvsDataSource)) {
            if (this.viewport) {
                this.viewport.scrollTo({ top: 0, behavior: 'auto' });
            }
            this.tvsDataSource.clearData();
            this.expandedElement = null;
        }
        if (this._rowSelectionModel) {
            this._rowSelectionModel.clear();
        }
        this.cdr.detectChanges();
    }
    /**
     * @return {?}
     */
    setDisplayedColumns() {
        if (this.columns) {
            this.displayedColumns = [];
            this.columns.forEach((/**
             * @param {?} colunm
             * @param {?} index
             * @return {?}
             */
            (colunm, index) => {
                colunm.index = index;
                if (colunm.display === undefined || colunm.display === 'visible' || colunm.display === 'prevent-hidden') {
                    this.displayedColumns.push(colunm.name);
                }
            }));
            //bugfixed because of double header show
            // if ((this._rowSelectionMode === 'multi' || this._rowSelectionMode === 'single') && this.displayedColumns.indexOf('row-checkbox') === -1) {
            //   this.displayedColumns.unshift('row-checkbox');
            // } 
            setTimeout((/**
             * @return {?}
             */
            () => {
                if ((this._rowSelectionMode === 'multi' || this._rowSelectionMode === 'single') && this.displayedColumns.indexOf('row-checkbox') === -1) {
                    this.displayedColumns.unshift('row-checkbox');
                }
            }), 0);
            if (this.tableSetting.visibleTableMenu !== false) {
                this.displayedColumns.push('table-menu');
            }
        }
        // this.updatePagination();
    }
    /**
     * ********************************* Drag & Drop Column ******************************************
     * @return {?}
     */
    refreshGrid() {
        this.cdr.detectChanges();
        this.table.renderRows();
    }
    /**
     * @param {?} from
     * @param {?} to
     * @return {?}
     */
    moveRow(from, to) {
        if (from >= 0 && from < this.tvsDataSource.data.length && to >= 0 && to < this.tvsDataSource.data.length) {
            this.tvsDataSource.data[from].id = to;
            this.tvsDataSource.data[to].id = from;
            moveItemInArray(this.tvsDataSource.data, from, to);
            this.tvsDataSource.data = Object.assign([], this.tvsDataSource.data);
        }
    }
    /**
     * @param {?} from
     * @param {?} to
     * @return {?}
     */
    moveColumn(from, to) {
        setTimeout((/**
         * @return {?}
         */
        () => {
            moveItemInArray(this.columns, from, to);
            this.refreshColumn(this.columns);
        }));
    }
    /**
     * @param {?} columns
     * @return {?}
     */
    refreshColumn(columns) {
        if (this.viewport) {
            /** @type {?} */
            const currentOffset = this.viewport.measureScrollOffset();
            this.columns = columns;
            this.setDisplayedColumns();
            setTimeout((/**
             * @return {?}
             */
            () => this.viewport.scrollTo({ top: currentOffset, behavior: 'auto' })), 0);
        }
    }
    /**
     * @param {?} tableSetting
     * @param {?=} raiseEvent
     * @return {?}
     */
    saveSetting(tableSetting, raiseEvent = false) {
        if (tableSetting !== null) {
            this.tableSetting = tableSetting;
            this.refreshColumn(tableSetting.columnSetting);
        }
        if (raiseEvent === true) {
            this.settingChange.emit(this.tableSetting);
        }
    }
    /************************************ Selection Table Row *******************************************/
    /**
     * Whether the number of selected elements matches the total number of rows.
     * @return {?}
     */
    isAllSelected() {
        /** @type {?} */
        const numSelected = this._rowSelectionModel.selected.length;
        /** @type {?} */
        const numRows = this.tvsDataSource.data.length;
        return numSelected === numRows;
    }
    /**
     * Selects all rows if they are not all selected; otherwise clear selection.
     * @return {?}
     */
    masterToggle() {
        this.isAllSelected() ?
            this._rowSelectionModel.clear() :
            this.tvsDataSource.data.forEach((/**
             * @param {?} row
             * @return {?}
             */
            row => this._rowSelectionModel.select(row)));
        this.onRowEvent.emit({ event: 'MasterSelectionChange', sender: this._rowSelectionModel });
    }
    /**
     * @param {?} e
     * @param {?} row
     * @return {?}
     */
    onRowSelectionChange(e, row) {
        if (e) {
            this._rowSelectionModel.toggle(row);
            this.onRowEvent.emit({ event: 'RowSelectionChange', sender: this._rowSelectionModel });
        }
    }
}
TableCoreDirective.decorators = [
    { type: Directive, args: [{
                // tslint:disable-next-line:directive-selector
                selector: '[core]'
            },] }
];
/** @nocollapse */
TableCoreDirective.ctorParameters = () => [
    { type: TableService },
    { type: ChangeDetectorRef }
];
TableCoreDirective.propDecorators = {
    sort: [{ type: ViewChild, args: [MatSort, { static: true },] }],
    paginator: [{ type: ViewChild, args: [MatPaginator, { static: true },] }],
    dataSource: [{ type: Input }],
    backgroundColor: [{ type: Input }],
    direction: [{ type: Input }, { type: HostBinding, args: ['style.direction',] }],
    contextMenuItems: [{ type: Input }],
    ScrollStrategyType: [{ type: Input }],
    pagingMode: [{ type: Input }],
    pagination: [{ type: Input }],
    rowSelectionModel: [{ type: Input }],
    rowSelectionMode: [{ type: Input }],
    tableName: [{ type: Input }],
    showProgress: [{ type: Input }],
    expandComponent: [{ type: Input }],
    rowContextMenuItems: [{ type: Input }],
    defaultWidth: [{ type: Input }],
    minWidth: [{ type: Input }],
    columns: [{ type: Input }],
    printConfig: [{ type: Input }],
    sticky: [{ type: Input }],
    pending: [{ type: Input }],
    rowHeight: [{ type: Input }],
    headerHeight: [{ type: Input }],
    footerHeight: [{ type: Input }],
    headerEnable: [{ type: Input }],
    footerEnable: [{ type: Input }],
    showNoData: [{ type: Input }],
    showReload: [{ type: Input }],
    onTableEvent: [{ type: Output }],
    onRowEvent: [{ type: Output }],
    settingChange: [{ type: Output }],
    paginationChange: [{ type: Output }],
    table: [{ type: ViewChild, args: [MatTable, { static: true },] }],
    viewport: [{ type: ViewChild, args: [CdkVirtualScrollViewport, { static: true },] }]
};
if (false) {
    /** @type {?} */
    TableCoreDirective.prototype.sort;
    /** @type {?} */
    TableCoreDirective.prototype.paginator;
    /** @type {?} */
    TableCoreDirective.prototype.dataSource;
    /** @type {?} */
    TableCoreDirective.prototype.backgroundColor;
    /** @type {?} */
    TableCoreDirective.prototype.contextMenuItems;
    /** @type {?} */
    TableCoreDirective.prototype.expandColumn;
    /**
     * @type {?}
     * @private
     */
    TableCoreDirective.prototype._expandComponent;
    /** @type {?} */
    TableCoreDirective.prototype.rowContextMenuItems;
    /** @type {?} */
    TableCoreDirective.prototype.defaultWidth;
    /** @type {?} */
    TableCoreDirective.prototype.minWidth;
    /**
     * ************************************ I/O parameters ********************************
     * @type {?}
     */
    TableCoreDirective.prototype.printConfig;
    /** @type {?} */
    TableCoreDirective.prototype.sticky;
    /** @type {?} */
    TableCoreDirective.prototype.pending;
    /** @type {?} */
    TableCoreDirective.prototype.rowHeight;
    /** @type {?} */
    TableCoreDirective.prototype.headerHeight;
    /** @type {?} */
    TableCoreDirective.prototype.footerHeight;
    /** @type {?} */
    TableCoreDirective.prototype.headerEnable;
    /** @type {?} */
    TableCoreDirective.prototype.footerEnable;
    /** @type {?} */
    TableCoreDirective.prototype.showNoData;
    /** @type {?} */
    TableCoreDirective.prototype.showReload;
    /** @type {?} */
    TableCoreDirective.prototype.onTableEvent;
    /** @type {?} */
    TableCoreDirective.prototype.onRowEvent;
    /** @type {?} */
    TableCoreDirective.prototype.settingChange;
    /** @type {?} */
    TableCoreDirective.prototype.paginationChange;
    /**
     * ************************************ Expand Row ********************************
     * @type {?}
     */
    TableCoreDirective.prototype.expandedElement;
    /** @type {?} */
    TableCoreDirective.prototype.progressColumn;
    /** @type {?} */
    TableCoreDirective.prototype.displayedColumns;
    /** @type {?} */
    TableCoreDirective.prototype.tableColumns;
    /** @type {?} */
    TableCoreDirective.prototype.tvsDataSource;
    /**
     * @type {?}
     * @private
     */
    TableCoreDirective.prototype._rowSelectionMode;
    /**
     * @type {?}
     * @private
     */
    TableCoreDirective.prototype._rowSelectionModel;
    /**
     * @type {?}
     * @private
     */
    TableCoreDirective.prototype._tablePagination;
    /** @type {?} */
    TableCoreDirective.prototype.tablePagingMode;
    /** @type {?} */
    TableCoreDirective.prototype.viewportClass;
    /** @type {?} */
    TableCoreDirective.prototype.tableSetting;
    /**
     * ************************************* Refrence Variables **************************************
     * @type {?}
     */
    TableCoreDirective.prototype.table;
    /** @type {?} */
    TableCoreDirective.prototype.viewport;
    /** @type {?} */
    TableCoreDirective.prototype.tableService;
    /** @type {?} */
    TableCoreDirective.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29yZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9keW5hbWljLW1hdC10YWJsZS8iLCJzb3VyY2VzIjpbImxpYi9jb3Jlcy90YWJsZS5jb3JlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLGlCQUFpQixFQUFjLE1BQU0sZUFBZSxDQUFDO0FBRW5ILE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNsRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzFELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUk5RSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDakQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sUUFBUSxDQUFDO0FBR2pFLE9BQU8sRUFBRSxlQUFlLEVBQWMsTUFBTSxNQUFNLENBQUM7Ozs7QUFNbkQsTUFBTSxPQUFPLGtCQUFrQjs7Ozs7SUFnTjdCLFlBQW1CLFlBQTBCLEVBQVMsR0FBc0I7UUFBekQsaUJBQVksR0FBWixZQUFZLENBQWM7UUFBUyxRQUFHLEdBQUgsR0FBRyxDQUFt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LDBDQUFxQzs7SUFDckMsc0NBQXdCOzs7OztJQXVDeEIseUNBQXVDOztJQUN2QyxvQ0FBeUI7O0lBQ3pCLHFDQUEwQjs7SUFDMUIsdUNBQXdCOztJQUN4QiwwQ0FBMkI7O0lBQzNCLDBDQUEyQjs7SUFDM0IsMENBQTZCOztJQUM3QiwwQ0FBOEI7O0lBQzlCLHdDQUE2Qjs7SUFDN0Isd0NBQTZCOztJQUU3QiwwQ0FBdUU7O0lBQ3ZFLHdDQUFtRTs7SUFDbkUsMkNBQWdFOztJQUNoRSw4Q0FBK0U7Ozs7O0lBTy9FLDZDQUFpQzs7SUFZakMsNENBQThCOztJQUM5Qiw4Q0FBZ0M7O0lBRWhDLDBDQUFxQzs7SUFDckMsMkNBQWdHOzs7OztJQUVoRywrQ0FBOEM7Ozs7O0lBQzlDLGdEQUE2RDs7Ozs7SUFDN0QsOENBQWdEOztJQUNoRCw2Q0FBc0Q7O0lBQ3RELDJDQUEyRjs7SUFDM0YsMENBQTJCOzs7OztJQUczQixtQ0FBOEQ7O0lBQzlELHNDQUE0Rjs7SUF6QmhGLDBDQUFpQzs7SUFBRSxpQ0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJUm93RXZlbnQsIElSb3dBY3Rpb25NZW51RXZlbnQsIFRhYmxlUm93LCBUYWJsZVNlbGVjdGlvbk1vZGUsIElUYWJsZUV2ZW50IH0gZnJvbSAnLi4vbW9kZWxzL3RhYmxlLXJvdy5tb2RlbCc7XHJcbmltcG9ydCB7IFRhYmxlVmlydHVhbFNjcm9sbERhdGFTb3VyY2UgfSBmcm9tICcuL3RhYmxlLWRhdGEtc291cmNlJztcclxuaW1wb3J0IHsgVmlld0NoaWxkLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIEhvc3RCaW5kaW5nLCBDaGFuZ2VEZXRlY3RvclJlZiwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUYWJsZUZpZWxkIH0gZnJvbSAnLi4vbW9kZWxzL3RhYmxlLWZpZWxkLm1vZGVsJztcclxuaW1wb3J0IHsgdGl0bGVDYXNlIH0gZnJvbSAnLi4vdXRpbGllcy90ZXh0LnV0aWxzJztcclxuaW1wb3J0IHsgQ2RrVmlydHVhbFNjcm9sbFZpZXdwb3J0IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3Njcm9sbGluZyc7XHJcbmltcG9ydCB7IG1vdmVJdGVtSW5BcnJheSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9kcmFnLWRyb3AnO1xyXG5pbXBvcnQgeyBTZWxlY3Rpb25Nb2RlbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2xsZWN0aW9ucyc7XHJcbmltcG9ydCB7IFRhYmxlU2VydmljZSB9IGZyb20gJy4uL2R5bmFtaWMtbWF0LXRhYmxlL2R5bmFtaWMtbWF0LXRhYmxlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBUYWJsZVBhZ2luYXRpb24sIFRhYmxlUGFnaW5hdGlvbk1vZGUgfSBmcm9tICcuLi9tb2RlbHMvdGFibGUtcGFnaW5hdGlvbi5tb2RlbCc7XHJcbmltcG9ydCB7IFByaW50Q29uZmlnIH0gZnJvbSAnLi4vbW9kZWxzL3ByaW50LWNvbmZpZy5tb2RlbCc7XHJcbmltcG9ydCB7IFRhYmxlU2V0dGluZywgRGlyZWN0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL3RhYmxlLXNldHRpbmcubW9kZWwnO1xyXG5pbXBvcnQgeyBNYXRTb3J0IH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc29ydCc7XHJcbmltcG9ydCB7IE1hdFBhZ2luYXRvciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3BhZ2luYXRvcic7XHJcbmltcG9ydCB7IE1hdFRhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvdGFibGUnO1xyXG5pbXBvcnQgeyBEaXJlY3RpdmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgY2xvbmUsIGdldE9iamVjdFByb3AsIGlzTnVsbG9yVW5kZWZpbmVkIH0gZnJvbSAnLi90eXBlJztcclxuaW1wb3J0IHsgVGFibGVTY3JvbGxTdHJhdGVneSB9IGZyb20gJy4vZml4ZWQtc2l6ZS10YWJsZS12aXJ0dWFsLXNjcm9sbC1zdHJhdGVneSc7XHJcbmltcG9ydCB7IENvbnRleHRNZW51SXRlbSB9IGZyb20gJy4uL21vZGVscy9jb250ZXh0LW1lbnUubW9kZWwnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpkaXJlY3RpdmUtc2VsZWN0b3JcclxuICBzZWxlY3RvcjogJ1tjb3JlXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIFRhYmxlQ29yZURpcmVjdGl2ZTxUIGV4dGVuZHMgVGFibGVSb3c+IHtcclxuICBAVmlld0NoaWxkKE1hdFNvcnQsIHsgc3RhdGljOiB0cnVlIH0pIHNvcnQ6IE1hdFNvcnQ7XHJcbiAgQFZpZXdDaGlsZChNYXRQYWdpbmF0b3IsIHsgc3RhdGljOiB0cnVlIH0pIHBhZ2luYXRvcjogTWF0UGFnaW5hdG9yOyBcclxuICBASW5wdXQoKSBwdWJsaWMgZGF0YVNvdXJjZTogQmVoYXZpb3JTdWJqZWN0PGFueVtdPjtcclxuICBASW5wdXQoKSBiYWNrZ3JvdW5kQ29sb3I6IHN0cmluZyA9IG51bGw7XHJcbiAgQElucHV0KClcclxuICBASG9zdEJpbmRpbmcoJ3N0eWxlLmRpcmVjdGlvbicpXHJcbiAgZ2V0IGRpcmVjdGlvbigpOiBEaXJlY3Rpb24ge1xyXG4gICAgcmV0dXJuIHRoaXMudGFibGVTZXR0aW5nPy5kaXJlY3Rpb247XHJcbiAgfVxyXG4gIHNldCBkaXJlY3Rpb24odmFsdWU6IERpcmVjdGlvbikge1xyXG4gICAgdGhpcy50YWJsZVNldHRpbmcuZGlyZWN0aW9uID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKSBjb250ZXh0TWVudUl0ZW1zOiBDb250ZXh0TWVudUl0ZW1bXSA9IFtdO1xyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IFNjcm9sbFN0cmF0ZWd5VHlwZSgpIHtcclxuICAgIHJldHVybiB0aGlzLnRhYmxlU2V0dGluZy5zY3JvbGxTdHJhdGVneTtcclxuICB9XHJcbiAgc2V0IFNjcm9sbFN0cmF0ZWd5VHlwZSh2YWx1ZTogVGFibGVTY3JvbGxTdHJhdGVneSkgeyAgICAgICAgXHJcbiAgICB0aGlzLnZpZXdwb3J0Wydfc2Nyb2xsU3RyYXRlZ3knXS5zY3JvbGxTdHJhdGVneU1vZGUgPSB2YWx1ZTtcclxuICAgIHRoaXMudGFibGVTZXR0aW5nLnNjcm9sbFN0cmF0ZWd5ID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIGdldCBwYWdpbmdNb2RlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudGFibGVQYWdpbmdNb2RlO1xyXG4gIH1cclxuICBzZXQgcGFnaW5nTW9kZSh2YWx1ZTogVGFibGVQYWdpbmF0aW9uTW9kZSkge1xyXG4gICAgdGhpcy50YWJsZVBhZ2luZ01vZGUgPSB2YWx1ZTtcclxuICAgIHRoaXMudXBkYXRlUGFnaW5hdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBnZXQgcGFnaW5hdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLl90YWJsZVBhZ2luYXRpb247XHJcbiAgfVxyXG4gIHNldCBwYWdpbmF0aW9uKHZhbHVlOiBUYWJsZVBhZ2luYXRpb24pIHtcclxuICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSAhPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLl90YWJsZVBhZ2luYXRpb24gPSB2YWx1ZTtcclxuICAgICAgaWYgKCBpc051bGxvclVuZGVmaW5lZCh0aGlzLl90YWJsZVBhZ2luYXRpb24ucGFnZVNpemVPcHRpb25zKSkge1xyXG4gICAgICAgIHRoaXMuX3RhYmxlUGFnaW5hdGlvbi5wYWdlU2l6ZU9wdGlvbnMgPSBbNSwgMTAsIDI1LCAxMDBdO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICggaXNOdWxsb3JVbmRlZmluZWQodGhpcy5fdGFibGVQYWdpbmF0aW9uLnBhZ2VTaXplT3B0aW9ucykpIHtcclxuICAgICAgICB0aGlzLl90YWJsZVBhZ2luYXRpb24ucGFnZVNpemUgPSB0aGlzLl90YWJsZVBhZ2luYXRpb24ucGFnZVNpemVPcHRpb25zWzBdO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudXBkYXRlUGFnaW5hdGlvbigpO1xyXG4gICAgfVxyXG4gIH0gXHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IHJvd1NlbGVjdGlvbk1vZGVsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsO1xyXG4gIH1cclxuICBzZXQgcm93U2VsZWN0aW9uTW9kZWwodmFsdWU6IFNlbGVjdGlvbk1vZGVsPFQ+KSB7IFxyXG4gICAgaWYgKCFpc051bGxvclVuZGVmaW5lZCh2YWx1ZSkpIHtcclxuICAgICAgaWYgKHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgJiYgdmFsdWUgJiYgdGhpcy5fcm93U2VsZWN0aW9uTW9kZSAhPT0gJ25vbmUnKSB7XHJcbiAgICAgICAgdGhpcy5fcm93U2VsZWN0aW9uTW9kZSA9ICh2YWx1ZS5pc011bHRpcGxlU2VsZWN0aW9uKCkgPT09IHRydWUgPyAnbXVsdGknOiAnc2luZ2xlJyk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fcm93U2VsZWN0aW9uTW9kZWwgPSB2YWx1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IHJvd1NlbGVjdGlvbk1vZGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcm93U2VsZWN0aW9uTW9kZTtcclxuICB9XHJcbiAgc2V0IHJvd1NlbGVjdGlvbk1vZGUoc2VsZWN0aW9uOiBUYWJsZVNlbGVjdGlvbk1vZGUpIHsgICAgXHJcbiAgICBzZWxlY3Rpb24gPSBzZWxlY3Rpb24gfHwgJ25vbmUnO1xyXG4gICAgdGhpcy5fcm93U2VsZWN0aW9uTW9kZWwgPSBzZWxlY3Rpb24gPT09ICdub25lJyA/IG51bGwgOiBuZXcgU2VsZWN0aW9uTW9kZWw8VD4oc2VsZWN0aW9uID09PSAnbXVsdGknLCBbXSk7ICAgIFxyXG4gICAgaWYoc2VsZWN0aW9uID09PSAnbm9uZScgJiYgdGhpcy5fcm93U2VsZWN0aW9uTW9kZSAhPT0gJ25vbmUnICYmIHRoaXMuZGlzcGxheWVkQ29sdW1uc1swXSA9PT0gJ3Jvdy1jaGVja2JveCcpIHtcclxuICAgICAgdGhpcy5kaXNwbGF5ZWRDb2x1bW5zLnNoaWZ0KCk7ICAgICAgICAgICAgXHJcbiAgICAgIHRoaXMuc2F2ZVNldHRpbmcodGhpcy50YWJsZVNldHRpbmcsZmFsc2UpO1xyXG4gICAgfSBlbHNlIGlmKHNlbGVjdGlvbiAhPT0gJ25vbmUnICYmIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgPT09ICdub25lJykge1xyXG4gICAgICB0aGlzLmRpc3BsYXllZENvbHVtbnMudW5zaGlmdCgncm93LWNoZWNrYm94Jyk7ICAgICAgICAgICAgXHJcbiAgICAgIHRoaXMuc2F2ZVNldHRpbmcodGhpcy50YWJsZVNldHRpbmcsZmFsc2UpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fcm93U2VsZWN0aW9uTW9kZSA9IHNlbGVjdGlvbjsgICAgXHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIGdldCB0YWJsZU5hbWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy50YWJsZVNlcnZpY2UudGFibGVOYW1lO1xyXG4gIH1cclxuICBzZXQgdGFibGVOYW1lKHZhbHVlOiBzdHJpbmcpIHtcclxuICAgIHRoaXMudGFibGVTZXJ2aWNlLnRhYmxlTmFtZSA9IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBnZXQgc2hvd1Byb2dyZXNzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucHJvZ3Jlc3NDb2x1bW4ubGVuZ3RoID4gMDtcclxuICB9XHJcbiAgc2V0IHNob3dQcm9ncmVzcyh2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgdGhpcy5wcm9ncmVzc0NvbHVtbiA9IFtdO1xyXG4gICAgaWYgKHZhbHVlID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMucHJvZ3Jlc3NDb2x1bW4ucHVzaCgncHJvZ3Jlc3MnKTtcclxuICAgIH1cclxuICB9IFxyXG5cclxuICAvLyBwcml2YXRlIHRvdGFsUmVjb3JkID0gMDtcclxuXHJcbiAgLy8gQElucHV0KCkgXHJcbiAgLy8gZ2V0IGRhdGFTb3VyY2UoKSB7ICAgIFxyXG4gIC8vICAgaWYoaXNOdWxsb3JVbmRlZmluZWQodGhpcy50dnNEYXRhU291cmNlKSkgeyAgICAgIFxyXG4gIC8vICAgICByZXR1cm4gbnVsbDtcclxuICAvLyAgIH0gICAgXHJcbiAgLy8gICBpZiAodGhpcy50b3RhbFJlY29yZCAhPT0gdGhpcy50dnNEYXRhU291cmNlLmFsbERhdGEubGVuZ3RoKSB7ICAgICAgXHJcbiAgLy8gICAgIHRoaXMuaW5pdFN5c3RlbUZpZWxkKHRoaXMudHZzRGF0YVNvdXJjZS5hbGxEYXRhKTtcclxuICAvLyAgIH1cclxuICAvLyAgIHJldHVybiB0aGlzLnR2c0RhdGFTb3VyY2U7XHJcbiAgLy8gfSBcclxuICAvLyBzZXQgZGF0YVNvdXJjZSh2YWx1ZTogVGFibGVWaXJ0dWFsU2Nyb2xsRGF0YVNvdXJjZTxUPikgeyAgICAgICAgICAgXHJcbiAgLy8gICB0aGlzLmNsZWFyKCk7ICAgIFxyXG4gIC8vICAgaWYgKCFpc051bGxvclVuZGVmaW5lZCh2YWx1ZSkpIHsgICAgICBcclxuICAvLyAgICAgdGhpcy5pbml0U3lzdGVtRmllbGQodmFsdWUuZGF0YSk7XHJcbiAgLy8gICAgIHRoaXMudHZzRGF0YVNvdXJjZSA9IHZhbHVlO1xyXG4gIC8vICAgICB0aGlzLnR2c0RhdGFTb3VyY2Uuc29ydCA9IHRoaXMuc29ydDtcclxuICAvLyAgICAgKHRoaXMudHZzRGF0YVNvdXJjZSBhcyBhbnkpLl9wYWdpbmF0b3IgPSB2YWx1ZTsgICAgICBcclxuICAvLyAgIH0gXHJcbiAgLy8gfVxyXG5cclxuICBwcm90ZWN0ZWQgaW5pdFN5c3RlbUZpZWxkKGRhdGE6IGFueVtdKSB7ICAgIFxyXG4gICAgZGF0YSA9IGRhdGEubWFwKCAoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgaXRlbS5pZCA9IGluZGV4IDtcclxuICAgICAgaXRlbS5vcHRpb24gPSBpdGVtLm9wdGlvbiB8fCB7fTsgICAgICBcclxuICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBleHBhbmRDb2x1bW4gPSBbXTtcclxuICBwcml2YXRlIF9leHBhbmRDb21wb25lbnQ6IGFueTtcclxuICBASW5wdXQoKVxyXG4gIGdldCBleHBhbmRDb21wb25lbnQoKTogYW55IHsgICAgXHJcbiAgICByZXR1cm4gdGhpcy5fZXhwYW5kQ29tcG9uZW50O1xyXG4gIH1cclxuICBzZXQgZXhwYW5kQ29tcG9uZW50KHZhbHVlOiBhbnkpIHsgICAgXHJcbiAgICB0aGlzLl9leHBhbmRDb21wb25lbnQgPSB2YWx1ZTtcclxuICAgIGlmICh0aGlzLl9leHBhbmRDb21wb25lbnQgIT09IG51bGwgJiYgdGhpcy5fZXhwYW5kQ29tcG9uZW50ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpcy5leHBhbmRDb2x1bW4gPSBbJ2V4cGFuZGVkRGV0YWlsJ107XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmV4cGFuZENvbHVtbiA9IFtdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQElucHV0KCkgcHVibGljIHJvd0NvbnRleHRNZW51SXRlbXM6IENvbnRleHRNZW51SXRlbVtdO1xyXG4gIEBJbnB1dCgpIGRlZmF1bHRXaWR0aDogbnVtYmVyID0gbnVsbDtcclxuICBASW5wdXQoKSBtaW5XaWR0aCA9IDEyMDtcclxuICBASW5wdXQoKVxyXG4gIGdldCBjb2x1bW5zKCkge1xyXG4gICAgcmV0dXJuIHRoaXMudGFibGVDb2x1bW5zO1xyXG4gIH1cclxuICBzZXQgY29sdW1ucyhmaWVsZHM6IFRhYmxlRmllbGQ8VD5bXSkge1xyXG4gICAgKGZpZWxkcyB8fCBbXSkuZm9yRWFjaCgoZiwgaSkgPT4ge1xyXG4gICAgICAvLyBrZXkgbmFtZSBlcnJvciAvL1xyXG4gICAgICBpZiAoZi5uYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpZCcpIHtcclxuICAgICAgICB0aHJvdyAnRmllbGQgbmFtZSBpcyByZXNlcnZlZC5bXCJpZFwiXSc7XHJcbiAgICAgIH0gICAgICBcclxuICAgICAgY29uc3Qgc2V0dGluZ0ZpZWxkcyA9ICh0aGlzLnRhYmxlU2V0dGluZy5jb2x1bW5TZXR0aW5nIHx8IFtdKS5maWx0ZXIocyA9PiBzLm5hbWUgPT09IGYubmFtZSk7XHJcbiAgICAgIGNvbnN0IHNldHRpbmdGaWVsZCA9IHNldHRpbmdGaWVsZHMubGVuZ3RoID4gMCA/IHNldHRpbmdGaWVsZHNbMF0gOiBudWxsO1xyXG4gICAgICAvLyBkZWZhdWx0IHZhbHVlIGZvciBmaWVsZHNcclxuICAgICAgZi5wcmludGFibGUgPSBmLnByaW50YWJsZSB8fCB0cnVlO1xyXG4gICAgICBmLmV4cG9ydGFibGUgPSBmLmV4cG9ydGFibGUgfHwgdHJ1ZTtcclxuICAgICAgZi50b0V4cG9ydCA9IGYudG9FeHBvcnQgfHwgKCh2YWx1ZSwgdHlwZSkgPT4gdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyA/IG51bGwgOiB2YWx1ZSB8fCAnJyk7XHJcbiAgICAgIGYudG9QcmludCA9ICh2YWx1ZSkgPT4gIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgPyBudWxsIDogdmFsdWUgfHwgJyc7XHJcbiAgICAgIGYuZW5hYmxlQ29udGV4dE1lbnUgPSBmLmVuYWJsZUNvbnRleHRNZW51IHx8IHRydWU7XHJcbiAgICAgIGYuaGVhZGVyID0gZi5oZWFkZXIgfHwgdGl0bGVDYXNlKGYubmFtZSk7XHJcbiAgICAgIGYuZGlzcGxheSA9IGdldE9iamVjdFByb3AoJ2Rpc3BsYXknLCAndmlzaWJsZScgLCBzZXR0aW5nRmllbGQsIGYgKTtcclxuICAgICAgZi5maWx0ZXIgPSBnZXRPYmplY3RQcm9wKCdmaWx0ZXInLCAnY2xpZW50LXNpZGUnICwgc2V0dGluZ0ZpZWxkLCBmICk7XHJcbiAgICAgIGYuc29ydCA9IGdldE9iamVjdFByb3AoJ3NvcnQnLCAnY2xpZW50LXNpZGUnICwgc2V0dGluZ0ZpZWxkLCBmICk7XHJcbiAgICAgIGYuc3RpY2t5ID0gZ2V0T2JqZWN0UHJvcCgnc3RpY2t5JywgJ25vbmUnICwgc2V0dGluZ0ZpZWxkLCBmICk7XHJcbiAgICAgIGYud2lkdGggPSAgZ2V0T2JqZWN0UHJvcCgnd2lkdGgnLCB0aGlzLmRlZmF1bHRXaWR0aCAsIHNldHRpbmdGaWVsZCwgZiApO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLnRhYmxlQ29sdW1ucyA9IGZpZWxkczsgICBcclxuICAgIHRoaXMudXBkYXRlQ29sdW1uKCk7ICAgICBcclxuICB9XHJcblxyXG4gIHB1YmxpYyB1cGRhdGVDb2x1bW4oKSB7XHJcbiAgICBpZiAoaXNOdWxsb3JVbmRlZmluZWQodGhpcy50YWJsZVNldHRpbmcuY29sdW1uU2V0dGluZykpIHtcclxuICAgICAgdGhpcy50YWJsZVNldHRpbmcuY29sdW1uU2V0dGluZyA9IGNsb25lKHRoaXMudGFibGVDb2x1bW5zKTtcclxuICAgICAgdGhpcy5yZWZyZXNoVGFibGVTZXR0aW5nKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNldERpc3BsYXllZENvbHVtbnMoKTtcclxuICB9XHJcblxyXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogSS9PIHBhcmFtZXRlcnMgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG4gIEBJbnB1dCgpIHByaW50Q29uZmlnOiBQcmludENvbmZpZyA9IHt9OyAgXHJcbiAgQElucHV0KCkgc3RpY2t5OiBib29sZWFuO1xyXG4gIEBJbnB1dCgpIHBlbmRpbmc6IGJvb2xlYW47XHJcbiAgQElucHV0KCkgcm93SGVpZ2h0ID0gNDg7XHJcbiAgQElucHV0KCkgaGVhZGVySGVpZ2h0ID0gNTY7XHJcbiAgQElucHV0KCkgZm9vdGVySGVpZ2h0ID0gNDg7XHJcbiAgQElucHV0KCkgaGVhZGVyRW5hYmxlID0gdHJ1ZTtcclxuICBASW5wdXQoKSBmb290ZXJFbmFibGUgPSBmYWxzZTtcclxuICBASW5wdXQoKSBzaG93Tm9EYXRhOiBib29sZWFuO1xyXG4gIEBJbnB1dCgpIHNob3dSZWxvYWQ6IGJvb2xlYW47ICBcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLW91dHB1dC1vbi1wcmVmaXhcclxuICBAT3V0cHV0KCkgb25UYWJsZUV2ZW50OiBFdmVudEVtaXR0ZXI8SVRhYmxlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSBvblJvd0V2ZW50OiBFdmVudEVtaXR0ZXI8SVJvd0V2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgc2V0dGluZ0NoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHBhZ2luYXRpb25DaGFuZ2U6IEV2ZW50RW1pdHRlcjxUYWJsZVBhZ2luYXRpb24+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIFxyXG5cclxuICAvLyoqdGhpcyBldmVudCBpcyBkZXBlcmFjdCBhbmQgbW92ZSB0byBvblJvd0V2ZW50ICovXHJcbiAgLy8gQE91dHB1dCgpIHJvd0FjdGlvbk1lbnVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxJUm93QWN0aW9uTWVudUV2ZW50PGFueT4+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIFxyXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogRXhwYW5kIFJvdyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbiAgZXhwYW5kZWRFbGVtZW50OiBUYWJsZVJvdyB8IG51bGw7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB0YWJsZVNlcnZpY2U6IFRhYmxlU2VydmljZSwgcHVibGljIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHsgICAgXHJcbiAgICB0aGlzLnNob3dQcm9ncmVzcyA9IHRydWU7XHJcbiAgICB0aGlzLnRhYmxlU2V0dGluZyA9IHtcclxuICAgICAgZGlyZWN0aW9uOiAnbHRyJyxcclxuICAgICAgY29sdW1uU2V0dGluZzogbnVsbCxcclxuICAgICAgdmlzaWJhbGVBY3Rpb25NZW51OiBudWxsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gVmFyaWFibGVzIC8vXHJcbiAgcHJvZ3Jlc3NDb2x1bW46IHN0cmluZ1tdID0gW107XHJcbiAgZGlzcGxheWVkQ29sdW1uczogc3RyaW5nW10gPSBbXTtcclxuICAvLyBwcml2YXRlIG1lbnVzOiBUYWJsZU1lbnVbXSA9IFtdO1xyXG4gIHB1YmxpYyB0YWJsZUNvbHVtbnM6IFRhYmxlRmllbGQ8VD5bXTtcclxuICBwdWJsaWMgdHZzRGF0YVNvdXJjZTogVGFibGVWaXJ0dWFsU2Nyb2xsRGF0YVNvdXJjZTxUPiA9IG5ldyBUYWJsZVZpcnR1YWxTY3JvbGxEYXRhU291cmNlPFQ+KFtdKTtcclxuXHJcbiAgcHJpdmF0ZSBfcm93U2VsZWN0aW9uTW9kZTogVGFibGVTZWxlY3Rpb25Nb2RlO1xyXG4gIHByaXZhdGUgX3Jvd1NlbGVjdGlvbk1vZGVsID0gbmV3IFNlbGVjdGlvbk1vZGVsPFQ+KHRydWUsIFtdKTtcclxuICBwcml2YXRlIF90YWJsZVBhZ2luYXRpb246IFRhYmxlUGFnaW5hdGlvbiA9IHsgfTtcclxuICBwdWJsaWMgdGFibGVQYWdpbmdNb2RlOiBUYWJsZVBhZ2luYXRpb25Nb2RlICA9ICdub25lJztcclxuICBwdWJsaWMgdmlld3BvcnRDbGFzczogJ3ZpZXdwb3J0JyB8ICd2aWV3cG9ydC13aXRoLXBhZ2luYXRpb24nID0gJ3ZpZXdwb3J0LXdpdGgtcGFnaW5hdGlvbic7XHJcbiAgdGFibGVTZXR0aW5nOiBUYWJsZVNldHRpbmc7XHJcblxyXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIFJlZnJlbmNlIFZhcmlhYmxlcyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbiAgQFZpZXdDaGlsZChNYXRUYWJsZSwgeyBzdGF0aWM6IHRydWUgfSkgdGFibGUgITogTWF0VGFibGU8YW55PjtcclxuICBAVmlld0NoaWxkKENka1ZpcnR1YWxTY3JvbGxWaWV3cG9ydCwgeyBzdGF0aWM6IHRydWUgfSkgdmlld3BvcnQgITogQ2RrVmlydHVhbFNjcm9sbFZpZXdwb3J0OyAgICBcclxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBNZXRob2RzICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG4gIHJlZnJlc2hUYWJsZVNldHRpbmcoKSB7XHJcbiAgICAvLyB0aGlzLnRhYmxlU2V0dGluZyA9IGNsb25lKHRoaXMudGFibGVTZXR0aW5nKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVBhZ2luYXRpb24oKSB7ICAgIFxyXG4gICAgaWYgKGlzTnVsbG9yVW5kZWZpbmVkKHRoaXMudHZzRGF0YVNvdXJjZSkpe1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9ICAgICAgXHJcbiAgICBpZiAodGhpcy50YWJsZVBhZ2luZ01vZGUgPT09ICdjbGllbnQtc2lkZScgfHwgdGhpcy50YWJsZVBhZ2luZ01vZGUgPT09ICdzZXJ2ZXItc2lkZScpIHtcclxuICAgICAgdGhpcy52aWV3cG9ydENsYXNzID0gJ3ZpZXdwb3J0LXdpdGgtcGFnaW5hdGlvbic7XHJcbiAgICAgIGlmICggIWlzTnVsbG9yVW5kZWZpbmVkKHRoaXMudHZzRGF0YVNvdXJjZS5wYWdpbmF0b3IpKSB7XHJcbiAgICAgICAgbGV0IGRhdGFMZW4gPSB0aGlzLnR2c0RhdGFTb3VyY2UucGFnaW5hdG9yLmxlbmd0aDtcclxuICAgICAgICBpZiAoIWlzTnVsbG9yVW5kZWZpbmVkKHRoaXMuX3RhYmxlUGFnaW5hdGlvbi5sZW5ndGgpICYmIHRoaXMuX3RhYmxlUGFnaW5hdGlvbi5sZW5ndGggPiBkYXRhTGVuKSB7XHJcbiAgICAgICAgICBkYXRhTGVuID0gdGhpcy5fdGFibGVQYWdpbmF0aW9uLmxlbmd0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50dnNEYXRhU291cmNlLnBhZ2luYXRvci5sZW5ndGggPSBkYXRhTGVuO1xyXG4gICAgICB9IFxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy52aWV3cG9ydENsYXNzID0gJ3ZpZXdwb3J0JztcclxuICAgICAgaWYgKCh0aGlzLnR2c0RhdGFTb3VyY2UgYXMgYW55KS5fcGFnaW5hdG9yICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBkZWxldGUgKHRoaXMudHZzRGF0YVNvdXJjZSBhcyBhbnkpLl9wYWdpbmF0b3I7XHJcbiAgICAgIH1cclxuICAgIH0gXHJcbiAgICB0aGlzLnR2c0RhdGFTb3VyY2UucmVmcmVzaEZpbHRlclByZWRpY2F0ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNsZWFyKCkge1xyXG4gICAgaWYgKCFpc051bGxvclVuZGVmaW5lZCh0aGlzLnR2c0RhdGFTb3VyY2UpKSB7XHJcbiAgICAgIGlmICh0aGlzLnZpZXdwb3J0KSB7XHJcbiAgICAgICAgdGhpcy52aWV3cG9ydC5zY3JvbGxUbyh7IHRvcDogMCwgYmVoYXZpb3I6ICdhdXRvJyB9KTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnR2c0RhdGFTb3VyY2UuY2xlYXJEYXRhKCk7XHJcbiAgICAgIHRoaXMuZXhwYW5kZWRFbGVtZW50ID0gbnVsbDtcclxuICAgIH1cclxuICAgIGlmKHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsKSB7XHJcbiAgICAgIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsLmNsZWFyKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKClcclxuICB9ICBcclxuIFxyXG4gIHNldERpc3BsYXllZENvbHVtbnMoKSB7ICAgIFxyXG4gICAgaWYgKHRoaXMuY29sdW1ucykge1xyXG4gICAgICB0aGlzLmRpc3BsYXllZENvbHVtbnMgPSBbXTtcclxuICAgICAgdGhpcy5jb2x1bW5zLmZvckVhY2goKGNvbHVubSwgaW5kZXgpID0+IHtcclxuICAgICAgICBjb2x1bm0uaW5kZXggPSBpbmRleDtcclxuICAgICAgICBpZiAoY29sdW5tLmRpc3BsYXkgPT09IHVuZGVmaW5lZCB8fCBjb2x1bm0uZGlzcGxheSA9PT0gJ3Zpc2libGUnIHx8IGNvbHVubS5kaXNwbGF5ID09PSAncHJldmVudC1oaWRkZW4nKSB7XHJcbiAgICAgICAgICB0aGlzLmRpc3BsYXllZENvbHVtbnMucHVzaChjb2x1bm0ubmFtZSk7XHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICAgIH0pOyBcclxuICAgICAgLy9idWdmaXhlZCBiZWNhdXNlIG9mIGRvdWJsZSBoZWFkZXIgc2hvd1xyXG4gICAgICAvLyBpZiAoKHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgPT09ICdtdWx0aScgfHwgdGhpcy5fcm93U2VsZWN0aW9uTW9kZSA9PT0gJ3NpbmdsZScpICYmIHRoaXMuZGlzcGxheWVkQ29sdW1ucy5pbmRleE9mKCdyb3ctY2hlY2tib3gnKSA9PT0gLTEpIHtcclxuICAgICAgLy8gICB0aGlzLmRpc3BsYXllZENvbHVtbnMudW5zaGlmdCgncm93LWNoZWNrYm94Jyk7XHJcbiAgICAgIC8vIH0gXHJcbiAgICAgIHNldFRpbWVvdXQoICgpID0+IHtcclxuICAgICAgICBpZiAoKHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGUgPT09ICdtdWx0aScgfHwgdGhpcy5fcm93U2VsZWN0aW9uTW9kZSA9PT0gJ3NpbmdsZScpICYmIHRoaXMuZGlzcGxheWVkQ29sdW1ucy5pbmRleE9mKCdyb3ctY2hlY2tib3gnKSA9PT0gLTEpIHtcclxuICAgICAgICAgIHRoaXMuZGlzcGxheWVkQ29sdW1ucy51bnNoaWZ0KCdyb3ctY2hlY2tib3gnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIDApOyBcclxuXHJcbiAgICAgIGlmICh0aGlzLnRhYmxlU2V0dGluZy52aXNpYmxlVGFibGVNZW51ICE9PSBmYWxzZSkge1xyXG4gICAgICAgIHRoaXMuZGlzcGxheWVkQ29sdW1ucy5wdXNoKCd0YWJsZS1tZW51Jyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIHRoaXMudXBkYXRlUGFnaW5hdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBEcmFnICYgRHJvcCBDb2x1bW4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8gXHJcbiAgcHVibGljIHJlZnJlc2hHcmlkKCkge1xyXG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpXHJcbiAgICB0aGlzLnRhYmxlLnJlbmRlclJvd3MoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBtb3ZlUm93KGZyb206IG51bWJlciwgdG86IG51bWJlcikge1xyXG4gICAgaWYgKGZyb20gPj0gMCAmJiBmcm9tIDwgdGhpcy50dnNEYXRhU291cmNlLmRhdGEubGVuZ3RoICAmJiB0byA+PSAwICYmIHRvIDwgdGhpcy50dnNEYXRhU291cmNlLmRhdGEubGVuZ3RoICkgeyAgICAgIFxyXG4gICAgICB0aGlzLnR2c0RhdGFTb3VyY2UuZGF0YVtmcm9tXS5pZCA9IHRvO1xyXG4gICAgICB0aGlzLnR2c0RhdGFTb3VyY2UuZGF0YVt0b10uaWQgPSBmcm9tOyAgICAgICAgXHJcbiAgICAgIG1vdmVJdGVtSW5BcnJheSh0aGlzLnR2c0RhdGFTb3VyY2UuZGF0YSwgZnJvbSwgdG8pO1xyXG4gICAgICB0aGlzLnR2c0RhdGFTb3VyY2UuZGF0YSA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMudHZzRGF0YVNvdXJjZS5kYXRhKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG1vdmVDb2x1bW4oZnJvbTogbnVtYmVyLCB0bzogbnVtYmVyKSB7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgbW92ZUl0ZW1JbkFycmF5KHRoaXMuY29sdW1ucywgZnJvbSwgdG8pO1xyXG4gICAgICB0aGlzLnJlZnJlc2hDb2x1bW4odGhpcy5jb2x1bW5zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVmcmVzaENvbHVtbihjb2x1bW5zOiBUYWJsZUZpZWxkPFQ+W10pIHtcclxuICAgIGlmICh0aGlzLnZpZXdwb3J0KSB7ICAgICAgXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRPZmZzZXQgPSB0aGlzLnZpZXdwb3J0Lm1lYXN1cmVTY3JvbGxPZmZzZXQoKTtcclxuICAgICAgdGhpcy5jb2x1bW5zID0gY29sdW1ucztcclxuICAgICAgdGhpcy5zZXREaXNwbGF5ZWRDb2x1bW5zKCk7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy52aWV3cG9ydC5zY3JvbGxUbyh7IHRvcDogY3VycmVudE9mZnNldCwgYmVoYXZpb3I6ICdhdXRvJyB9KSwgMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzYXZlU2V0dGluZyh0YWJsZVNldHRpbmc6IFRhYmxlU2V0dGluZywgcmFpc2VFdmVudDogYm9vbGVhbiA9IGZhbHNlKSB7ICAgIFxyXG4gICAgaWYgKHRhYmxlU2V0dGluZyAhPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnRhYmxlU2V0dGluZyA9IHRhYmxlU2V0dGluZztcclxuICAgICAgdGhpcy5yZWZyZXNoQ29sdW1uKHRhYmxlU2V0dGluZy5jb2x1bW5TZXR0aW5nKTtcclxuICAgIH1cclxuICAgIGlmIChyYWlzZUV2ZW50ID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMuc2V0dGluZ0NoYW5nZS5lbWl0KHRoaXMudGFibGVTZXR0aW5nKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogU2VsZWN0aW9uIFRhYmxlIFJvdyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuICAvKiogV2hldGhlciB0aGUgbnVtYmVyIG9mIHNlbGVjdGVkIGVsZW1lbnRzIG1hdGNoZXMgdGhlIHRvdGFsIG51bWJlciBvZiByb3dzLiAqL1xyXG4gIGlzQWxsU2VsZWN0ZWQoKSB7XHJcbiAgICBjb25zdCBudW1TZWxlY3RlZCA9IHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsLnNlbGVjdGVkLmxlbmd0aDtcclxuICAgIGNvbnN0IG51bVJvd3MgPSB0aGlzLnR2c0RhdGFTb3VyY2UuZGF0YS5sZW5ndGg7XHJcbiAgICByZXR1cm4gbnVtU2VsZWN0ZWQgPT09IG51bVJvd3M7XHJcbiAgfVxyXG5cclxuICAvKiogU2VsZWN0cyBhbGwgcm93cyBpZiB0aGV5IGFyZSBub3QgYWxsIHNlbGVjdGVkOyBvdGhlcndpc2UgY2xlYXIgc2VsZWN0aW9uLiAqL1xyXG4gIG1hc3RlclRvZ2dsZSgpIHtcclxuICAgIHRoaXMuaXNBbGxTZWxlY3RlZCgpID9cclxuICAgICAgdGhpcy5fcm93U2VsZWN0aW9uTW9kZWwuY2xlYXIoKSA6XHJcbiAgICAgIHRoaXMudHZzRGF0YVNvdXJjZS5kYXRhLmZvckVhY2gocm93ID0+IHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsLnNlbGVjdChyb3cpKTsgICAgXHJcbiAgICB0aGlzLm9uUm93RXZlbnQuZW1pdCh7IGV2ZW50OiAnTWFzdGVyU2VsZWN0aW9uQ2hhbmdlJywgc2VuZGVyOiAgdGhpcy5fcm93U2VsZWN0aW9uTW9kZWx9KTtcclxuICB9XHJcblxyXG4gIG9uUm93U2VsZWN0aW9uQ2hhbmdlKGU6IGFueSwgcm93OiBUKSB7XHJcbiAgICBpZiAoZSkgeyAgICAgIFxyXG4gICAgICB0aGlzLl9yb3dTZWxlY3Rpb25Nb2RlbC50b2dnbGUocm93KTtcclxuICAgICAgdGhpcy5vblJvd0V2ZW50LmVtaXQoeyBldmVudDogJ1Jvd1NlbGVjdGlvbkNoYW5nZScsIHNlbmRlcjogIHRoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogVGhlIGxhYmVsIGZvciB0aGUgY2hlY2tib3ggb24gdGhlIHBhc3NlZCByb3cgKi9cclxuICAvLyBjaGVja2JveExhYmVsKHJvdz86IFQpOiBzdHJpbmcge1xyXG4gIC8vICAgaWYgKCFyb3cpIHtcclxuICAvLyAgICAgcmV0dXJuIGAke3RoaXMuaXNBbGxTZWxlY3RlZCgpID8gJ3NlbGVjdCcgOiAnZGVzZWxlY3QnfSBhbGxgO1xyXG4gIC8vICAgfVxyXG4gIC8vICAgcmV0dXJuIGAke3RoaXMuX3Jvd1NlbGVjdGlvbk1vZGVsLmlzU2VsZWN0ZWQocm93KSA/ICdkZXNlbGVjdCcgOiAnc2VsZWN0J30gcm93ICR7cm93LmlkICsgMX1gO1xyXG4gIC8vIH0gXHJcblxyXG59XHJcblxyXG4iXX0=